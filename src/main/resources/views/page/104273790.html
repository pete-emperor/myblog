<html>
<head>
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/detail-4bfa3af0c6.min.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/themes/skin3-template/skin3-template-c9d2f651cc.min.css">
<link rel="stylesheet" href="https://csdnimg.cn/public/sandalstrap/1.4/css/sandalstrap.min.css">
<link rel="stylesheet" href="https://csdnimg.cn/public/common/toolbar/content_toolbar_css/content_toolbar.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/blog_code-c3a0c33d5c.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/vendor/pagination/paging-e040f0c7c8.css">
<style>
        .MathJax, .MathJax_Message, .MathJax_Preview{
            display: none
        }
    </style>
</head>
<body class="nodata " > 
    <link rel="stylesheet" href="https://csdnimg.cn/public/common/toolbar/content_toolbar_css/content_toolbar.css">
    <script id="toolbar-tpl-scriptId" src="https://csdnimg.cn/public/common/toolbar/js/content_toolbar.js" type="text/javascript" domain="https://blog.csdn.net/"></script>
    <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/blog_code-c3a0c33d5c.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/vendor/pagination/paging-e040f0c7c8.css">

<script type="text/javascript">
	var NEWS_FEED = function(){}
</script>

<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/chart-3456820cac.css" />
<div class="main_father clearfix d-flex justify-content-center" style="height:100%;"> 
    <div class="container clearfix" id="mainBox">
        <div  class='space_container'></div>
        <main>
            <div class="blog-content-box">
    <div class="article-header-box">
        <div class="article-header">
            <div class="article-title-box">
                <h1 class="title-article">é˜¿é‡Œé¢è¯•å®˜ï¼š è‡ªå®šä¹‰Viewè·Ÿç»˜åˆ¶æµç¨‹ç›¸å…³çŸ¥è¯†ç‚¹ï¼Ÿï¼ˆæ ‡å‡†å‚è€ƒè§£ç­”ï¼Œå€¼å¾—æ”¶è—ï¼‰</h1>
            </div>
            <div class="article-info-box">
                <div class="article-bar-top">
                    <!--æ–‡ç« ç±»å‹-->
                    <span class="article-type type-1 float-left">åŸåˆ›</span>                                                                                                                                            <a class="follow-nickName" href="https://me.csdn.net/weixin_43901866" target="_blank" rel="noopener">Android Developer</a>
                    <span class="time">æœ€åå‘å¸ƒäº2020-02-12 09:51:14                    </span>
                    <span class="read-count">é˜…è¯»æ•° 96</span>
                    <a id='blog_detail_zk_collection' class="un-collection" data-report-click='{"mod":"popu_823"}'>
                        <svg class="icon">
                            <use xlink:href="#icon-csdnc-Collection-G" ></use>
                        </svg>
                        <span>æ”¶è—</span>
                    </a>
                                    </div>
                                <div class="up-time">å‘å¸ƒäº2020-02-12 09:51:14</div>
                <div class="slide-content-box">
                                                        <div class="tags-box artic-tag-box">
                           <span class="label">åˆ†ç±»ä¸“æ ï¼š</span>
                                                                                             <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9337526.html">
                                       é˜¿é‡Œ                                   </a>
                                                                                                                            <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9415988.html">
                                       é¢è¯•                                   </a>
                                                                                                                            <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9439978.html">
                                       å­¦ä¹ èµ„æ–™                                   </a>
                                                                                  </div>
                                                                                                           <div class="article-copyright">
                        <span class="creativecommons">
                            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"></a>
                            <span>
                                ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œéµå¾ª<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 BY-SA </a>ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚                            </span>
                            <div class="article-source-link2222">
                                æœ¬æ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_43901866/article/details/104273790">https://blog.csdn.net/weixin_43901866/article/details/104273790</a>
                            </div>
                        </span> 
                        </div>
                                                                                </div>
                <div class="operating">
                                                                <a class="href-article-edit slide-toggle">å±•å¼€</a>
                                    </div>
            </div>
        </div>
    </div>
    <article class="baidu_pl">
        <!--pythonå®‰è£…æ‰‹å†Œå¼€å§‹-->
                <!--pythonå®‰è£…æ‰‹å†Œç»“æŸ-->
                <!--####ä¸“æ å¹¿å‘Šä½å›¾æ–‡åˆ‡æ¢å¼€å§‹-->
                                    <!--####ä¸“æ å¹¿å‘Šä½å›¾æ–‡åˆ‡æ¢ç»“æŸ-->
         <div id="article_content" class="article_content clearfix">
            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-833878f763.css" />
                            <div id="content_views" class="markdown_views prism-atom-one-dark">
                    <!-- flowchart ç®­å¤´å›¾æ ‡ å‹¿åˆ  -->
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                                            <blockquote>
<p>æœ¬æ–‡ç”¨äºè®°å½•è‡ªå®šä¹‰Viewçš„åŸºç¡€æ­¥éª¤ä»¥åŠä¸€äº›åŸºç¡€çš„ä¿¡æ¯ï¼ŒåæœŸå¯èƒ½é’ˆå¯¹å…·ä½“çš„ç‚¹å†™ä¸€äº›è¡¥å……æ€§çš„æ–‡ç« ã€‚</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0zNGIzZGJhYjUyNDllZDc2LnBuZw?x-oss-process=image/format,png" alt=""></p>
</blockquote>
<h3><a id="_View_8"></a>ä¸€ ã€Viewä¸­å…³äºå››ä¸ªæ„é€ å‡½æ•°å‚æ•°</h3>
<p>è‡ªå®šä¹‰Viewä¸­Viewçš„æ„é€ å‡½æ•°æœ‰å››ä¸ª</p>
<pre><code>//  ä¸»è¦æ˜¯åœ¨javaä»£ç ä¸­ç”Ÿå‘½ä¸€ä¸ªViewæ—¶æ‰€è°ƒç”¨ï¼Œæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œä¸€ä¸ªç©ºçš„Viewå¯¹è±¡
    public ChildrenView(Context context) {
        super(context);
    }
// åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨è¯¥è‡ªå®šä¹‰viewçš„æ—¶å€™ä¼šè°ƒç”¨åˆ°ï¼Œä¸€èˆ¬ä¼šè°ƒç”¨åˆ°è¯¥æ–¹æ³•
    public ChildrenView(Context context, AttributeSet attrs) {
        this(context, attrsï¼Œ0);
    }
//å¦‚æœä½ ä¸éœ€è¦Viewéšç€ä¸»é¢˜å˜åŒ–è€Œå˜åŒ–ï¼Œåˆ™ä¸Šé¢ä¸¤ä¸ªæ„é€ å‡½æ•°å°±å¯ä»¥äº†
//ä¸‹é¢ä¸¤ä¸ªæ˜¯ä¸ä¸»é¢˜ç›¸å…³çš„æ„é€ å‡½æ•°
   public ChildrenView(Context context, AttributeSet attrs, int defStyleAttr) {
        this(context, attrs, defStyleAttr, 0);
    }
//
    public ChildrenView(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) {
        super(context, attrs, defStyleAttr, defStyleRes);
    }
</code></pre>
<p>å››ä¸ªå‚æ•°è§£é‡Šï¼š</p>
<p><strong>context</strong>:ä¸Šä¸‹æ–‡</p>
<p><strong>AttributeSet attrs</strong>ï¼šä»xmlä¸­å®šä¹‰çš„å‚æ•°</p>
<p><strong>intdefStyleAttr</strong>ï¼šä¸»é¢˜ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å±æ€§</p>
<p><strong>intdefStyleRes</strong>ï¼š ä¼˜å…ˆçº§æ¬¡ä¹‹çš„å†…ç½®äºViewçš„style(è¿™é‡Œå°±æ˜¯è‡ªå®šä¹‰Viewè®¾ç½®æ ·å¼çš„åœ°æ–¹)</p>
<blockquote>
<ul>
<li><strong>å¤šä¸ªåœ°æ–¹å®šä¹‰å±æ€§ï¼Œä¼˜å…ˆçº§æ’åº</strong> Xmlç›´æ¥å®šä¹‰ &gt; xmlä¸­styleå¼•ç”¨ &gt; defStyleAttr&gt;defStyleRes &gt; themeç›´æ¥å®šä¹‰ (å‚è€ƒæ–‡ç« ï¼š<a href="https://www.jianshu.com/p/7389287c04bb" rel="nofollow">www.jianshu.com/p/7389287c0â€¦</a>)</li>
</ul>
</blockquote>
<h3><a id="_44"></a>äºŒã€è‡ªå®šä¹‰å±æ€§è¯´æ˜</h3>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0wYmYyNGM2ZTkzN2Q4ZDFhLnBuZw?x-oss-process=image/format,png" alt=""></p>
<p>é™¤äº†åŸºæœ¬ç±»å‹çš„ä¸è¯´ è®²ä¸€ä¸‹å…¶å®ƒå‡ ä¸ªå§ï¼š</p>
<ul>
<li>
<p>color ï¼šå¼•ç”¨é¢œè‰²</p>
</li>
<li>
<p>dimension: å¼•ç”¨å­—ä½“å¤§å°</p>
</li>
</ul>
<pre><code>//å®šä¹‰
&lt;attr name = "text_size" format = "dimension" /&gt;
//ä½¿ç”¨ï¼š
    app:text_size = "28sp" 
æˆ–è€… 
    app:text_size = "@android:dimen/app_icon_size"
</code></pre>
<ul>
<li>enumï¼šæšä¸¾å€¼</li>
</ul>
<pre><code>//å®šä¹‰
    &lt;attr name="orientation"&gt;
        &lt;enum name="horizontal" value="0" /&gt;
        &lt;enum name="vertical" value="1" /&gt;
    &lt;/attr&gt;
//ä½¿ç”¨ï¼š
    app:orientation = "vertical"
</code></pre>
<ul>
<li>flags:æ ‡å¿— ï¼ˆä½æˆ–è¿è¡Œï¼‰ ä¸»è¦ä½œç”¨=å¯ä»¥å¤šä¸ªå€¼</li>
</ul>
<pre><code>//å®šä¹‰
  &lt;attr name="gravity"&gt;
            &lt;flag name="top" value="0x01" /&gt;
            &lt;flag name="bottom" value="0x02" /&gt;
            &lt;flag name="left" value="0x04" /&gt;
            &lt;flag name="right" value="0x08" /&gt;
            &lt;flag name="center_vertical" value="0x16" /&gt;
    &lt;/attr&gt;
// ä½¿ç”¨
app:gravity = Top|left
</code></pre>
<ul>
<li>fraction:ç™¾åˆ†æ•°ï¼š</li>
</ul>
<pre><code>//å®šä¹‰ï¼š
&lt;attr name = "transparency" format = "fraction" /&gt;
//ä½¿ç”¨ï¼š
  app:transparency = "80%" 
</code></pre>
<ul>
<li>reference:å‚è€ƒ/å¼•ç”¨æŸä¸€èµ„æºID</li>
</ul>
<pre><code>//å®šä¹‰ï¼š
 &lt;attr name="leftIcon" format="reference" /&gt;
//ä½¿ç”¨ï¼š
app:leftIcon = "@drawable/å›¾ç‰‡ID"
</code></pre>
<ul>
<li>æ··åˆç±»å‹ï¼šå±æ€§å®šä¹‰æ—¶æŒ‡å®šå¤šç§ç±»å‹å€¼</li>
</ul>
<pre><code>//å±æ€§å®šä¹‰
 &lt;attr name = "background" format = "reference|color" /&gt;
//ä½¿ç”¨
android:background = "@drawable/å›¾ç‰‡ID" 
//æˆ–è€…
android:background = "#FFFFFF" 
</code></pre>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi1mZDE4ZGMxYzA0ZTc0ZGE5LnBuZw?x-oss-process=image/format,png" alt=""></p>
<h3><a id="_121"></a>ä¸‰ã€è‡ªå®šä¹‰æ§ä»¶ç±»å‹</h3>
<ul>
<li>
<h4><a id="_123"></a>è‡ªå®šä¹‰ç»„åˆæ§ä»¶æ­¥éª¤</h4>
</li>
</ul>
<h5><a id="1__125"></a>1. è‡ªå®šä¹‰å±æ€§</h5>
<p>åœ¨<code>res/values</code>ç›®å½•ä¸‹çš„<code>attrs.xml</code>æ–‡ä»¶ä¸­</p>
<pre><code>&lt;resources&gt;
&lt;declare-styleable name="CustomView"&gt;
        &lt;attr name="leftIcon" format="reference" /&gt;
        &lt;attr name="state" format="boolean"/&gt;
        &lt;attr name="name" format="string"/&gt;
    &lt;/declare-styleable&gt;
&lt;/resources&gt;
</code></pre>
<h5><a id="2__139"></a>2. å¸ƒå±€ä¸­ä½¿ç”¨è‡ªå®šä¹‰å±æ€§</h5>
<p>åœ¨å¸ƒå±€ä¸­ä½¿ç”¨</p>
<pre><code>&lt;com.myapplication.view.CustomView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                app:leftIcon="@mipmap/ic_temp"
                app:name="æ¸©åº¦"
                app:state="false" /&gt;
</code></pre>
<h5><a id="3_view_152"></a>3. viewçš„æ„é€ å‡½æ•°è·å–è‡ªå®šä¹‰å±æ€§</h5>
<pre><code>class DigitalCustomView : LinearLayout {
    constructor(context: Context) : super(context)
    constructor(context: Context, attrs: AttributeSet?) : super(context, attrs) {
        LayoutInflater.from(context).inflate(R.layout.view_custom, this)
        var ta = context.obtainStyledAttributes(attrs, R.styleable.CustomView)
        mIcon = ta.getResourceId(R.styleable.CustomView_leftIcon, -1) //å·¦å›¾åƒ
        mState = ta.getBoolean(R.styleable.DigitalCustomView_state, false)
        mName = ta.getString(R.styleable.CustomView_name)
        ta.recycle()
        initView()
    }

}
</code></pre>
<p>ä¸Šé¢ç»™å‡ºå¤§è‡´çš„ä»£ç  è®°å¾—è·å–<code>context.obtainStyledAttributes(attrs, R.styleable.CustomView)</code>æœ€åè¦è°ƒç”¨<code>ta.recycle()</code>åˆ©ç”¨å¯¹è±¡æ± å›æ”¶taåŠ ä»¥å¤ç”¨</p>
<ul>
<li>
<h4><a id="_172"></a>ç»§æ‰¿ç³»ç»Ÿæ§ä»¶</h4>
</li>
</ul>
<p>å°±æ˜¯ç»§æ‰¿ç³»ç»Ÿå·²ç»æä¾›å¥½ç»™æˆ‘ä»¬çš„æ§ä»¶ä¾‹å¦‚TextViewã€LinearLayoutç­‰,åˆ†ä¸ºViewç±»å‹æˆ–è€…ViewGroupç±»å‹çš„ä¸¤ç§ã€‚ä¸»è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œå®ç°ï¼Œå®ç°é‡å†™çš„ç©ºé—´ä¹Ÿå¾ˆå¤§ ä¸»è¦çœ‹éœ€æ±‚ã€‚</p>
<p>æ¯”å¦‚éœ€æ±‚ ï¼šåœ¨æ–‡å­—åé¢åŠ ä¸ªé¢œè‰²èƒŒæ™¯</p>
<p>æ ¹æ®éœ€è¦ä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯å¸Œæœ›å¯ä»¥å¤ç”¨ç³»ç»Ÿçš„<code>onMeaseur</code>å’Œ<code>onLayout</code>æµç¨‹.ç›´æ¥å¤å†™<code>onDraw</code>æ–¹æ³•</p>
<pre><code>class Practice02BeforeOnDrawView : AppCompatTextView {
    internal var paint = Paint(Paint.ANTI_ALIAS_FLAG)
    internal var bounds = RectF()

    constructor(context: Context) : super(context) {}

    constructor(context: Context, attrs: AttributeSet?) : super(context, attrs) {}

    constructor(context: Context, attrs: AttributeSet?, defStyleAttr: Int) : super(context, attrs, defStyleAttr) {}

    init {
        paint.color = Color.parseColor("#FFC107")
    }

    override fun onDraw(canvas: Canvas) {
        // æŠŠä¸‹é¢çš„ç»˜åˆ¶ä»£ç ç§»åˆ° super.onDraw() çš„ä¸Šé¢ï¼Œå°±å¯ä»¥è®©åŸä¸»ä½“å†…å®¹ç›–ä½ä½ çš„ç»˜åˆ¶ä»£ç äº†
        // ï¼ˆæˆ–è€…ä½ ä¹Ÿå¯ä»¥æŠŠ super.onDraw() ç§»åˆ°è¿™æ®µä»£ç çš„ä¸‹é¢ï¼‰
        val layout = layout
        bounds.left = layout.getLineLeft(1)
        bounds.right = layout.getLineRight(1)
        bounds.top = layout.getLineTop(1).toFloat()
        bounds.bottom = layout.getLineBottom(1).toFloat()
       //ç»˜åˆ¶æ–¹å½¢èƒŒæ™¯
        canvas.drawRect(bounds, paint)
        super.onDraw(canvas)
    }
}
</code></pre>
<blockquote>
<p>è¿™é‡Œä¼šæ¶‰åŠåˆ°ç”»ç¬”<code>Paint()</code>ã€ç”»å¸ƒ<code>canvas</code>ã€è·¯å¾„<code>Path</code>ã€ç»˜ç”»é¡ºåºç­‰çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œåé¢å†è¯¦ç»†è¯´æ˜</p>
</blockquote>
<ul>
<li>
<h4><a id="View_212"></a>ç›´æ¥ç»§æ‰¿View</h4>
</li>
</ul>
<p>è¿™ç§å°±æ˜¯ç±»ä¼¼TextViewç­‰ï¼Œä¸éœ€è¦å»è½®è®­å­<code>View</code>åªéœ€è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚é‡å†™<code>onMeasure()</code>ã€<code>onLayout()</code>ã€<code>onDraw()</code>ç­‰æ–¹æ³•ä¾¿å¯ä»¥ï¼Œè¦æ³¨æ„ç‚¹å°±æ˜¯è®°å¾—<code>Padding</code>ç­‰å€¼è¦è®°å¾—åŠ å…¥è¿ç®—</p>
<pre><code> private int getCalculateSize(int defaultSize, int measureSpec) {
        int finallSize = defaultSize;

        int mode = MeasureSpec.getMode(measureSpec);
        int size = MeasureSpec.getSize(measureSpec);
     //  æ ¹æ®æ¨¡å¼å¯¹
        switch (mode) {
            case MeasureSpec.EXACTLY: {
              ...
                break;
            }
            case MeasureSpec.AT_MOST: {
                ...
                break;
            }
            case MeasureSpec.UNSPECIFIED: {
               ...
                break;
            }
        }
        return finallSize;
}

@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        super.onMeasure(widthMeasureSpec, heightMeasureSpec);
        int width = getCalculateSize(120, widthMeasureSpec);
        int height = getCalculateSize(120, heightMeasureSpec);
        setMeasuredDimension(width, height);
}

  //ç”»ä¸€ä¸ªåœ†
    @Override
    protected void onDraw(Canvas canvas) {
        //è°ƒç”¨çˆ¶Viewçš„onDrawå‡½æ•°ï¼Œå› ä¸ºViewè¿™ä¸ªç±»å¸®æˆ‘ä»¬å®ç°äº†ä¸€äº›åŸºæœ¬çš„è€Œç»˜åˆ¶åŠŸèƒ½ï¼Œæ¯”å¦‚ç»˜åˆ¶èƒŒæ™¯é¢œè‰²ã€èƒŒæ™¯å›¾ç‰‡ç­‰
        super.onDraw(canvas);
        int r = getMeasuredWidth() / 2;
        //åœ†å¿ƒçš„æ¨ªåæ ‡ä¸ºå½“å‰çš„Viewçš„å·¦è¾¹èµ·å§‹ä½ç½®+åŠå¾„
        int centerX = getLeft() + r;
        //åœ†å¿ƒçš„çºµåæ ‡ä¸ºå½“å‰çš„Viewçš„é¡¶éƒ¨èµ·å§‹ä½ç½®+åŠå¾„
        int centerY = getTop() + r;

        Paint paint = new Paint();
        paint.setColor(Color.RED);
        canvas.drawCircle(centerX, centerY, r, paint);
    }

</code></pre>
<ul>
<li>
<h4><a id="ViewGroup_266"></a>ç›´æ¥ç»§æ‰¿ViewGroup</h4>
</li>
</ul>
<p>ç±»ä¼¼å®ç°LinearLayoutç­‰ï¼Œå¯ä»¥å»çœ‹é‚£ä¸€ä¸‹LinearLayoutçš„å®ç° åŸºæœ¬çš„ä½ å¯èƒ½è¦é‡å†™<code>onMeasure()</code>ã€<code>onLayout()</code>ã€<code>onDraw()</code>æ–¹æ³•,è¿™å—å¾ˆå¤šé—®é¢˜è¦å¤„ç†åŒ…æ‹¬è½®è®­<code>childView</code>çš„æµ‹é‡å€¼ä»¥åŠæ¨¡å¼è¿›è¡Œå¤§å°é€»è¾‘è®¡ç®—ç­‰ï¼Œè¿™ä¸ªç¯‡å¹…è¿‡å¤§åæœŸåŠ å¤šä¸ªæ–‡ç« å†™è¯¦ç»†çš„</p>
<p>è¿™é‡Œå†™ä¸ªç®€å•çš„éœ€æ±‚ï¼Œæ¨¡ä»¿<code>LinearLayout</code>çš„å‚ç›´å¸ƒå±€</p>
<pre><code>class CustomViewGroup :ViewGroup{

    constructor(context:Context):super(context)
    constructor(context: Context,attrs:AttributeSet):super(context,attrs){
            //å¯è·å–è‡ªå®šä¹‰çš„å±æ€§ç­‰
    }
    override fun onMeasure(widthMeasureSpec: Int, heightMeasureSpec: Int) {
        super.onMeasure(widthMeasureSpec, heightMeasureSpec)
        //å°†æ‰€æœ‰çš„å­Viewè¿›è¡Œæµ‹é‡ï¼Œè¿™ä¼šè§¦å‘æ¯ä¸ªå­Viewçš„onMeasureå‡½æ•°
        measureChildren(widthMeasureSpec, heightMeasureSpec)
        val widthMode = MeasureSpec.getMode(widthMeasureSpec)
        val widthSize = MeasureSpec.getSize(widthMeasureSpec)
        val heightMode = MeasureSpec.getMode(heightMeasureSpec)
        val heightSize = MeasureSpec.getSize(heightMeasureSpec)
        val childCount = childCount
        if (childCount == 0) {
            //æ²¡æœ‰å­Viewçš„æƒ…å†µ
            setMeasuredDimension(0, 0)
        } else {
            //å¦‚æœå®½é«˜éƒ½æ˜¯åŒ…è£¹å†…å®¹
            if (widthMode == MeasureSpec.AT_MOST &amp;&amp; heightMode == MeasureSpec.AT_MOST) {
                //æˆ‘ä»¬å°†é«˜åº¦è®¾ç½®ä¸ºæ‰€æœ‰å­Viewçš„é«˜åº¦ç›¸åŠ ï¼Œå®½åº¦è®¾ä¸ºå­Viewä¸­æœ€å¤§çš„å®½åº¦
                val height = getTotalHeight()
                val width = getMaxChildWidth()
                setMeasuredDimension(width, height)
            } else if (heightMode == MeasureSpec.AT_MOST) {
                //å¦‚æœåªæœ‰é«˜åº¦æ˜¯åŒ…è£¹å†…å®¹
                //å®½åº¦è®¾ç½®ä¸ºViewGroupè‡ªå·±çš„æµ‹é‡å®½åº¦ï¼Œé«˜åº¦è®¾ç½®ä¸ºæ‰€æœ‰å­Viewçš„é«˜åº¦æ€»å’Œ
                setMeasuredDimension(widthSize, getTotalHeight())
            } else if (widthMode == MeasureSpec.AT_MOST) {//å¦‚æœåªæœ‰å®½åº¦æ˜¯åŒ…è£¹å†…å®¹
                //å®½åº¦è®¾ç½®ä¸ºå­Viewä¸­å®½åº¦æœ€å¤§çš„å€¼ï¼Œé«˜åº¦è®¾ç½®ä¸ºViewGroupè‡ªå·±çš„æµ‹é‡å€¼
                setMeasuredDimension(getMaxChildWidth(), heightSize)

            }
        }
    /***
     * è·å–å­Viewä¸­å®½åº¦æœ€å¤§çš„å€¼
     */
    private fun getMaxChildWidth(): Int {
        val childCount = childCount
        var maxWidth = 0
        for (i in 0 until childCount) {
            val childView = getChildAt(i)
            if (childView.measuredWidth &gt; maxWidth)
                maxWidth = childView.measuredWidth

        }
        return maxWidth
    }

    /***
     * å°†æ‰€æœ‰å­Viewçš„é«˜åº¦ç›¸åŠ 
     */
    private fun getTotalHeight(): Int {
        val childCount = childCount
        var height = 0
        for (i in 0 until childCount) {
            val childView = getChildAt(i)
            height += childView.measuredHeight

        }

        return height
    }

    }

    override fun onLayout(changed: Boolean, l: Int, t: Int, r: Int, b: Int) {
        val count = childCount
        var currentHeight = t
        for (i in 0 until count) {
            val child = getChildAt(i)
            val h = child.measuredHeight
            val w = child.measuredWidth
            //æ‘†æ”¾å­view
            child.layout(l, currentHeight, l + w, currentHeight + h)
            currentHeight += h
        }
    }
}
</code></pre>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi03MzdlOWMxNmNjNjM0OTYzLnBuZw?x-oss-process=image/format,png" alt=""></p>
<blockquote>
<p>ä¸»è¦ä¸¤ç‚¹ å…ˆ <code>measureChildren()</code>è½®è®­éå†å­<code>View</code>è·å–å®½é«˜,å¹¶æ ¹æ®æµ‹é‡æ¨¡å¼é€»è¾‘è®¡ç®—æœ€åæ‰€æœ‰çš„æ§ä»¶çš„æ‰€éœ€å®½é«˜ï¼Œæœ€å<code>setMeasuredDimension()</code>ä¿å­˜ä¸€ä¸‹ ###å››ã€ Viewçš„ç»˜åˆ¶æµç¨‹ç›¸å…³ æœ€åŸºæœ¬çš„ä¸‰ä¸ªç›¸å…³å‡½æ•° <code>measure()</code> -&gt;<code>layout()</code>-&gt;<code>draw()</code></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi1hOWQzNzE0MjUxZWY2NzQzLnBuZw?x-oss-process=image/format,png" alt=""></p>
</blockquote>
<h3><a id="onMeasure_362"></a>äº”ã€onMeasure()ç›¸å…³çš„çŸ¥è¯†ç‚¹</h3>
<h4><a id="1_MeasureSpec_364"></a>1. MeasureSpec</h4>
<p><code>MeasureSpec</code>æ˜¯<code>View</code>çš„å†…éƒ¨ç±»ï¼Œå®ƒå°è£…äº†ä¸€ä¸ª<code>View</code>çš„å°ºå¯¸ï¼Œåœ¨<code>onMeasure()</code>å½“ä¸­ä¼šæ ¹æ®è¿™ä¸ª<code>MeasureSpec</code>çš„å€¼æ¥ç¡®å®š<code>View</code>çš„å®½é«˜ã€‚ <code>MeasureSpec</code> çš„æ•°æ®æ˜¯<code>int</code>ç±»å‹ï¼Œæœ‰<code>32</code>ä½ã€‚ é«˜ä¸¤ä½è¡¨ç¤ºæ¨¡å¼ï¼Œåé¢<code>30</code>ä½è¡¨ç¤ºå¤§å°<code>size</code>ã€‚åˆ™<code>MeasureSpec = mode+size</code> ä¸‰ç§æ¨¡å¼åˆ†åˆ«ä¸ºï¼š<code>EXACTLY</code>,<code>AT_MOST</code>,<code>UNSPECIFIED</code></p>
<blockquote>
<p><code>EXACTLY</code>: ï¼ˆ<code>match_parent</code>æˆ–è€… <code>ç²¾ç¡®æ•°æ®å€¼</code>ï¼‰ç²¾ç¡®æ¨¡å¼ï¼Œå¯¹åº”çš„æ•°å€¼å°±æ˜¯<code>MeasureSpec</code>å½“ä¸­çš„<code>size</code></p>
<p><code>AT_MOST</code>ğŸ˜¦<code>wrap_content)</code>æœ€å¤§å€¼æ¨¡å¼ï¼ŒViewçš„å°ºå¯¸æœ‰ä¸€ä¸ªæœ€å¤§å€¼ï¼Œ<code>View</code>ä¸è¶…è¿‡<code>MeasureSpec</code>å½“ä¸­çš„<code>Size</code>å€¼</p>
<p><code>UNSPECIFIED</code>ï¼šï¼ˆä¸€èˆ¬ç³»ç»Ÿä½¿ç”¨ï¼‰æ— é™åˆ¶æ¨¡å¼ï¼ŒViewè®¾ç½®å¤šå¤§å°±ç»™ä»–å¤šå¤§</p>
</blockquote>
<pre><code>//è·å–æµ‹é‡æ¨¡å¼
 val widthMode = MeasureSpec.getMode(widthMeasureSpec)
//è·å–æµ‹é‡å¤§å° 
val widthSize = MeasureSpec.getSize(widthMeasureSpec)
//é€šè¿‡Modeå’ŒSizeæ„é€ MeasureSpec
val measureSpec = MeasureSpec.makeMeasureSpec(size, mode);
</code></pre>
<h4><a id="2_View_onMeasure_383"></a>2. View #onMeasure()æºç </h4>
<pre><code>   protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),
                getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));
    }
    protected int getSuggestedMinimumWidth() {
        return (mBackground == null) ? mMinWidth : max(mMinWidth, mBackground.getMinimumWidth());
    }
    protected final void setMeasuredDimension(int measuredWidth, int measuredHeight) {
        boolean optical = isLayoutModeOptical(this);
        if (optical != isLayoutModeOptical(mParent)) {
            Insets insets = getOpticalInsets();
            int opticalWidth  = insets.left + insets.right;
            int opticalHeight = insets.top  + insets.bottom;

            measuredWidth  += optical ? opticalWidth  : -opticalWidth;
            measuredHeight += optical ? opticalHeight : -opticalHeight;
        }
        setMeasuredDimensionRaw(measuredWidth, measuredHeight);
    }
    public static int getDefaultSize(int size, int measureSpec) {
        int result = size;
        int specMode = MeasureSpec.getMode(measureSpec);
        int specSize = MeasureSpec.getSize(measureSpec);

        switch (specMode) {
        case MeasureSpec.UNSPECIFIED:
            result = size;
            break;
        case MeasureSpec.AT_MOST:
        case MeasureSpec.EXACTLY:
            result = specSize;
            break;
        }
        return result;
    }
    private void setMeasuredDimensionRaw(int measuredWidth, int measuredHeight) {
        mMeasuredWidth = measuredWidth;
        mMeasuredHeight = measuredHeight;

        mPrivateFlags |= PFLAG_MEASURED_DIMENSION_SET;
    }
</code></pre>
<ul>
<li>
<p><strong>setMeasuredDimension(int measuredWidth, int measuredHeight)</strong> ï¼šç”¨æ¥è®¾ç½®Viewçš„å®½é«˜ï¼Œåœ¨æˆ‘ä»¬è‡ªå®šä¹‰Viewä¿å­˜å®½é«˜ä¹Ÿä¼šè¦ç”¨åˆ°ã€‚</p>
</li>
<li>
<p><strong>getSuggestedMinimumWidth()</strong>ï¼šå½“Viewæ²¡æœ‰è®¾ç½®èƒŒæ™¯æ—¶ï¼Œé»˜è®¤å¤§å°å°±æ˜¯<code>mMinWidth</code>ï¼Œè¿™ä¸ªå€¼å¯¹åº”<code>Android:minWidth</code>å±æ€§ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®æ—¶é»˜è®¤ä¸º0. å¦‚æœæœ‰è®¾ç½®èƒŒæ™¯ï¼Œåˆ™é»˜è®¤å¤§å°ä¸º<code>mMinWidth</code>å’Œ<code>mBackground.getMinimumWidth()</code>å½“ä¸­çš„è¾ƒå¤§å€¼ã€‚</p>
</li>
<li>
<p><strong>getDefaultSize(int size, int measureSpec)</strong>ï¼šç”¨æ¥è·å–Viewé»˜è®¤çš„å®½é«˜ï¼Œåœ¨**getDefaultSize()**ä¸­å¯¹<code>MeasureSpec.AT_MOST</code>,<code>MeasureSpec.EXACTLY</code>ä¸¤ä¸ªçš„å¤„ç†æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰<code>View</code>çš„æ—¶å€™ è¦å¯¹ä¸¤ç§æ¨¡å¼è¿›è¡Œå¤„ç†ã€‚</p>
</li>
</ul>
<h4><a id="3_ViewGroupmeasureonMeasure_435"></a>3. ViewGroupä¸­å¹¶æ²¡æœ‰measure()ä¹Ÿæ²¡æœ‰onMeasure()</h4>
<p>å› ä¸ºViewGroupé™¤äº†æµ‹é‡è‡ªèº«çš„å®½é«˜ï¼Œè¿˜éœ€è¦æµ‹é‡å„ä¸ªå­<code>View</code>çš„å®½é«˜ï¼Œä¸åŒçš„å¸ƒå±€æµ‹é‡æ–¹å¼ä¸åŒ (ä¾‹å¦‚ <code>LinearLayout</code>è·Ÿ<code>RelativeLayout</code>ç­‰å¸ƒå±€ï¼‰,æ‰€ä»¥ç›´æ¥äº¤ç”±ç»§æ‰¿è€…æ ¹æ®è‡ªå·±çš„éœ€è¦å»å¤å†™ã€‚ä½†æ˜¯é‡Œé¢å› ä¸ºå­<code>View</code>çš„æµ‹é‡æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œæ‰€ä»¥é‡Œé¢å·²ç»æä¾›äº†åŸºæœ¬çš„<code>measureChildren()</code>ä»¥åŠ<code>measureChild()</code>æ¥å¸®åŠ©æˆ‘ä»¬å¯¹å­<code>View</code>è¿›è¡Œæµ‹é‡ è¿™ä¸ªå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘å¦ä¸€ç¯‡æ–‡ç« ï¼š<code>LinearLayout # onMeasure()</code><a href="https://www.jianshu.com/p/61efaa047ae4" rel="nofollow">LinearLayout onMeasureæºç é˜…è¯»</a></p>
<h3><a id="onLayout_439"></a>å…­ã€onLayout()ç›¸å…³</h3>
<blockquote>
<ol>
<li>View.javaçš„onLayoutæ–¹æ³•æ˜¯ç©ºå®ç°:å› ä¸ºå­Viewçš„ä½ç½®ï¼Œæ˜¯ç”±å…¶çˆ¶æ§ä»¶çš„onLayoutæ–¹æ³•æ¥ç¡®å®šçš„ã€‚</li>
<li>onLayout(int l, int t, int r, int b)ä¸­çš„å‚æ•°lã€tã€rã€béƒ½æ˜¯ç›¸å¯¹äºå…¶çˆ¶ æ§ä»¶çš„ä½ç½®ã€‚</li>
<li>è‡ªèº«çš„mLeft, mTop, mRight, mBottoméƒ½æ˜¯ç›¸å¯¹äºçˆ¶æ§ä»¶çš„ä½ç½®ã€‚</li>
</ol>
</blockquote>
<h4><a id="1_Android_445"></a>1. Androidåæ ‡ç³»</h4>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi1jNjhiYzMzN2Q5YWEyMmQwLnBuZw?x-oss-process=image/format,png" alt=""></p>
<h4><a id="2_View_450"></a>2. å†…éƒ¨Viewåæ ‡ç³»è·Ÿç‚¹å‡»åæ ‡</h4>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0wNmRlZGRiMGRmMjJkMWZhLnBuZw?x-oss-process=image/format,png" alt=""></p>
<h4><a id="3_Viewlayoutint_l_int_t_int_r_int_b_454"></a>3. çœ‹ä¸€ä¸‹View#layout(int l, int t, int r, int b)æºç </h4>
<pre><code>public void layout(int l, int t, int r, int b) {
        if ((mPrivateFlags3 &amp; PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT) != 0) {
            onMeasure(mOldWidthMeasureSpec, mOldHeightMeasureSpec);
            mPrivateFlags3 &amp;= ~PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;
        }

        int oldL = mLeft;
        int oldT = mTop;
        int oldB = mBottom;
        int oldR = mRight;

        boolean changed = isLayoutModeOptical(mParent) ?
                setOpticalFrame(l, t, r, b) : setFrame(l, t, r, b);

        if (changed || (mPrivateFlags &amp; PFLAG_LAYOUT_REQUIRED) == PFLAG_LAYOUT_REQUIRED) {
            onLayout(changed, l, t, r, b);
   //   ....çœç•¥å…¶å®ƒéƒ¨åˆ†
    }
  private boolean setOpticalFrame(int left, int top, int right, int bottom) {
        Insets parentInsets = mParent instanceof View ?
                ((View) mParent).getOpticalInsets() : Insets.NONE;
        Insets childInsets = getOpticalInsets();
        return setFrame(
                left   + parentInsets.left - childInsets.left,
                top    + parentInsets.top  - childInsets.top,
                right  + parentInsets.left + childInsets.right,
                bottom + parentInsets.top  + childInsets.bottom);
    }
  protected boolean setFrame(int left, int top, int right, int bottom) {
        boolean changed = false;
    // ....çœç•¥å…¶å®ƒéƒ¨åˆ†
        if (mLeft != left || mRight != right || mTop != top || mBottom != bottom) {
            changed = true;
            int drawn = mPrivateFlags &amp; PFLAG_DRAWN;
            int oldWidth = mRight - mLeft;
            int oldHeight = mBottom - mTop;
            int newWidth = right - left;
            int newHeight = bottom - top;
            boolean sizeChanged = (newWidth != oldWidth) || (newHeight != oldHeight);
            invalidate(sizeChanged);
            mLeft = left;
            mTop = top;
            mRight = right;
            mBottom = bottom;
            mRenderNode.setLeftTopRightBottom(mLeft, mTop, mRight, mBottom);
            mPrivateFlags |= PFLAG_HAS_BOUNDS;
            if (sizeChanged) {
                sizeChange(newWidth, newHeight, oldWidth, oldHeight);
            }
            if ((mViewFlags &amp; VISIBILITY_MASK) == VISIBLE || mGhostView != null) {
                mPrivateFlags |= PFLAG_DRAWN;
                invalidate(sizeChanged);
                invalidateParentCaches();
            }
            mPrivateFlags |= drawn;
            mBackgroundSizeChanged = true;
            mDefaultFocusHighlightSizeChanged = true;
            if (mForegroundInfo != null) {
                mForegroundInfo.mBoundsChanged = true;
            }
            notifySubtreeAccessibilityStateChangedIfNeeded();
        }
        return changed;
    }

</code></pre>
<p>å››ä¸ªå‚æ•°<code>lã€tã€rã€b</code>åˆ†åˆ«ä»£è¡¨<code>View</code>çš„å·¦ã€ä¸Šã€å³ã€ä¸‹å››ä¸ªè¾¹ç•Œç›¸å¯¹äºå…¶çˆ¶<code>View</code>çš„è·ç¦»ã€‚ åœ¨è°ƒç”¨<code>onLayout(changed, l, t, r, b);</code>ä¹‹å‰éƒ½ä¼šè°ƒç”¨åˆ°<code>setFrame()</code>ç¡®å®š<code>View</code>åœ¨çˆ¶å®¹å™¨å½“ä¸­çš„ä½ç½®ï¼Œèµ‹å€¼ç»™<code>mLeft</code>,<code>mTop</code>,<code>mRight</code>,<code>mBottom</code>ã€‚ åœ¨<code>ViewGroup#onLayout()</code>è·Ÿ<code>View#onLayout()</code>éƒ½æ˜¯ç©ºå®ç°ï¼Œäº¤ç»™ç»§æ‰¿è€…æ ¹æ®è‡ªèº«éœ€æ±‚å»å®šä½</p>
<blockquote>
<p>éƒ¨åˆ†é›¶æ•£çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li><strong><code>getMeasureWidth()</code>ä¸<code>getWidth()</code></strong> <code>getMeasureWidth()</code>è¿”å›çš„æ˜¯<code>mMeasuredWidth</code>ï¼Œè€Œè¯¥å€¼æ˜¯åœ¨<code>setMeasureDimension()</code>ä¸­çš„<code>setMeasureDimensionRaw()</code>ä¸­è®¾ç½®çš„ã€‚å› æ­¤<code>onMeasure()</code>åçš„æ‰€æœ‰æ–¹æ³•éƒ½èƒ½è·å–åˆ°è¿™ä¸ªå€¼ã€‚ <code>getWidth</code>è¿”å›çš„æ˜¯<code>mRight-mLeft</code>ï¼Œè¿™ä¸¤ä¸ªå€¼ï¼Œæ˜¯åœ¨<code>layout()</code>ä¸­çš„<code>setFrame()</code>ä¸­è®¾ç½®çš„. <code>getMeasureWidthAndState</code>ä¸­æœ‰ä¸€å¥ï¼š <code>This should be used during measurement and layout calculations only. Use {@link #getWidth()} to see how wide a view is after layout.</code></li>
</ul>
<p>æ€»ç»“ï¼šåªæœ‰åœ¨æµ‹é‡è¿‡ç¨‹ä¸­å’Œå¸ƒå±€è®¡ç®—æ—¶ï¼Œæ‰ç”¨<code>getMeasuredWidth()</code>ã€‚åœ¨layoutä¹‹åï¼Œç”¨<code>getWidth()</code>æ¥è·å–å®½åº¦</p>
</blockquote>
<h3><a id="draw_532"></a>ä¸ƒã€draw()ç»˜ç”»è¿‡ç¨‹</h3>
<pre><code> /*
         * Draw traversal performs several drawing steps which must be executed
         * in the appropriate order:
         *
         *      1\. Draw the background
         *      2\. If necessary, save the canvas' layers to prepare for fading
         *      3\. Draw view's content
         *      4\. Draw children
         *      5\. If necessary, draw the fading edges and restore layers
         *      6\. Draw decorations (scrollbars for instance)
         */
</code></pre>
<blockquote>
<p>ä¸Šé¢æ˜¯<code>draw()</code>é‡Œé¢å†™çš„ç»˜ç”»é¡ºåºã€‚</p>
<ol>
<li>ç»˜åˆ¶èƒŒæ™¯ã€‚</li>
<li>å¦‚æœå¿…è¦çš„è¯,ä¿å­˜å½“å‰<code>canvas</code></li>
<li>ç»˜åˆ¶<code>View</code>çš„å†…å®¹</li>
<li>ç»˜åˆ¶å­<code>View</code></li>
<li>å¦‚æœå¿…è¦çš„è¯,ç»˜ç”»è¾¹ç¼˜é‡æ–°ä¿å­˜å›¾å±‚</li>
<li>ç”»è£…é¥°(ä¾‹å¦‚æ»šåŠ¨æ¡)</li>
</ol>
</blockquote>
<h4><a id="1_Viewdraw_557"></a>1. çœ‹ä¸€ä¸‹View#draw()æºç çš„å®ç°</h4>
<pre><code>public void draw(Canvas canvas) {
  // Step 1, draw the background, if needed
        int saveCount;

        if (!dirtyOpaque) {
            drawBackground(canvas);
        }

        // skip step 2 &amp; 5 if possible (common case)
        final int viewFlags = mViewFlags;
        boolean horizontalEdges = (viewFlags &amp; FADING_EDGE_HORIZONTAL) != 0;
        boolean verticalEdges = (viewFlags &amp; FADING_EDGE_VERTICAL) != 0;
        if (!verticalEdges &amp;&amp; !horizontalEdges) {
            // Step 3, draw the content
            if (!dirtyOpaque) onDraw(canvas);

            // Step 4, draw the children
            dispatchDraw(canvas);

            drawAutofilledHighlight(canvas);

            // Overlay is part of the content and draws beneath Foreground
            if (mOverlay != null &amp;&amp; !mOverlay.isEmpty()) {
                mOverlay.getOverlayView().dispatchDraw(canvas);
            }

            // Step 6, draw decorations (foreground, scrollbars)
            onDrawForeground(canvas);

            // Step 7, draw the default focus highlight
            drawDefaultFocusHighlight(canvas);

            if (debugDraw()) {
                debugDrawFocus(canvas);
            }

            // we're done...
            return;
        }
}

</code></pre>
<p>ç”±ä¸Šé¢å¯ä»¥çœ‹åˆ° å…ˆè°ƒç”¨<code>drawBackground(canvas)</code> -&gt;<code>onDraw(canvas)</code>-&gt;<code>dispatchDraw(canvas)</code>-&gt;<code>onDrawForeground(canvas)</code>è¶Šæ˜¯åé¢ç»˜ç”»çš„è¶Šæ˜¯è¦†ç›–åœ¨æœ€ä¸Šå±‚ã€‚</p>
<p><strong>drawBackground(canvas)</strong>:ç”»èƒŒæ™¯ï¼Œä¸å¯é‡å†™</p>
<p><strong>onDraw(canvas)</strong>ï¼šç”»ä¸»ä½“</p>
<ul>
<li><strong>ä»£ç å†™åœ¨super.onDraw()å‰</strong>ï¼šä¼šè¢«çˆ¶ç±»çš„onDrawè¦†ç›–</li>
<li><strong>ä»£ç å†™åœ¨super.onDraw()å</strong>ï¼šä¸ä¼šè¢«çˆ¶ç±»çš„onDrawè¦†ç›–</li>
</ul>
<p><strong>dispatchDraw()</strong> ï¼šç»˜åˆ¶å­ View çš„æ–¹æ³•</p>
<ul>
<li>
<p><strong>ä»£ç å†™åœ¨super.dispatchDraw(canvas)å‰</strong>ï¼šæŠŠç»˜åˆ¶ä»£ç å†™åœ¨ super.dispatchDraw() çš„ä¸Šé¢ï¼Œè¿™æ®µç»˜åˆ¶å°±ä¼šåœ¨ onDraw() ä¹‹åã€ super.dispatchDraw() ä¹‹å‰å‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯ç»˜åˆ¶å†…å®¹ä¼šå‡ºç°åœ¨ä¸»ä½“å†…å®¹å’Œå­ View ä¹‹é—´ã€‚è€Œè¿™ä¸ªâ€¦â€¦ å…¶å®å’Œé‡å†™ onDraw() å¹¶æŠŠç»˜åˆ¶ä»£ç å†™åœ¨ super.onDraw() ä¹‹åçš„åšæ³•ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
</li>
<li>
<p><strong>ä»£ç å†™åœ¨super.dispatchDraw(canvas)å</strong>ï¼šåªè¦é‡å†™ dispatchDraw()ï¼Œå¹¶åœ¨ super.dispatchDraw() çš„ä¸‹é¢å†™ä¸Šä½ çš„ç»˜åˆ¶ä»£ç ï¼Œè¿™æ®µç»˜åˆ¶ä»£ç å°±ä¼šå‘ç”Ÿåœ¨å­ View çš„ç»˜åˆ¶ä¹‹åï¼Œä»è€Œè®©ç»˜åˆ¶å†…å®¹ç›–ä½å­ View äº†ã€‚</p>
</li>
</ul>
<p><strong>onDrawForeground(canvas)</strong>ï¼šåŒ…å«äº†æ»‘åŠ¨è¾¹ç¼˜æ¸å˜å’Œæ»‘åŠ¨æ¡è·Ÿå‰æ™¯</p>
<blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ª Viewï¼ˆæˆ– ViewGroupï¼‰çš„ç»˜åˆ¶ä¸ä¼šè¿™å‡ é¡¹å…¨éƒ½åŒ…å«ï¼Œä½†å¿…ç„¶é€ƒä¸å‡ºè¿™å‡ é¡¹ï¼Œå¹¶ä¸”ä¸€å®šä¼šä¸¥æ ¼éµå®ˆè¿™ä¸ªé¡ºåºã€‚ä¾‹å¦‚é€šå¸¸ä¸€ä¸ª LinearLayout åªæœ‰èƒŒæ™¯å’Œå­ Viewï¼Œé‚£ä¹ˆå®ƒä¼šå…ˆç»˜åˆ¶èƒŒæ™¯å†ç»˜åˆ¶å­ Viewï¼›ä¸€ä¸ª ImageView æœ‰ä¸»ä½“ï¼Œæœ‰å¯èƒ½ä¼šå†åŠ ä¸Šä¸€å±‚åŠé€æ˜çš„å‰æ™¯ä½œä¸ºé®ç½©ï¼Œé‚£ä¹ˆå®ƒçš„å‰æ™¯ä¹Ÿä¼šåœ¨ä¸»ä½“ä¹‹åè¿›è¡Œç»˜åˆ¶ã€‚éœ€è¦æ³¨æ„ï¼Œå‰æ™¯çš„æ”¯æŒæ˜¯åœ¨ Android 6.0ï¼ˆä¹Ÿå°±æ˜¯ API 23ï¼‰æ‰åŠ å…¥çš„ï¼›ä¹‹å‰å…¶å®ä¹Ÿæœ‰ï¼Œä¸è¿‡åªæ”¯æŒ FrameLayoutï¼Œè€Œç›´åˆ° 6.0 æ‰æŠŠè¿™ä¸ªæ”¯æŒæ”¾è¿›äº† View ç±»é‡Œã€‚</p>
</blockquote>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi03N2U5ZGFkMzIwNzdmYTFhLnBuZw?x-oss-process=image/format,png" alt=""></p>
<h4><a id="2__625"></a>2. æ³¨æ„äº‹é¡¹</h4>
<h5><a id="21__ViewGroup__dispatchDraw__setWillNotDrawfalse_627"></a>2.1 åœ¨ ViewGroup çš„å­ç±»ä¸­é‡å†™é™¤ dispatchDraw() ä»¥å¤–çš„ç»˜åˆ¶æ–¹æ³•æ—¶ï¼Œå¯èƒ½éœ€è¦è°ƒç”¨ setWillNotDraw(false)ï¼›</h5>
<p><em>å‡ºäºæ•ˆç‡çš„è€ƒè™‘ï¼ŒViewGroup é»˜è®¤ä¼šç»•è¿‡ draw() æ–¹æ³•ï¼Œæ¢è€Œç›´æ¥æ‰§è¡Œ dispatchDraw()ï¼Œä»¥æ­¤æ¥ç®€åŒ–ç»˜åˆ¶æµç¨‹ã€‚æ‰€ä»¥å¦‚æœä½ è‡ªå®šä¹‰äº†æŸä¸ª ViewGroup çš„å­ç±»ï¼ˆæ¯”å¦‚ LinearLayoutï¼‰å¹¶ä¸”éœ€è¦åœ¨å®ƒçš„é™¤ dispatchDraw() ä»¥å¤–çš„ä»»ä½•ä¸€ä¸ªç»˜åˆ¶æ–¹æ³•å†…ç»˜åˆ¶å†…å®¹ï¼Œä½ å¯èƒ½ä¼šéœ€è¦è°ƒç”¨ View.setWillNotDraw(false) è¿™è¡Œä»£ç æ¥åˆ‡æ¢åˆ°å®Œæ•´çš„ç»˜åˆ¶æµç¨‹ï¼ˆæ˜¯ã€Œå¯èƒ½ã€è€Œä¸æ˜¯ã€Œå¿…é¡»ã€çš„åŸå› æ˜¯ï¼Œæœ‰äº› ViewGroup æ˜¯å·²ç»è°ƒç”¨è¿‡ setWillNotDraw(false) äº†çš„ï¼Œä¾‹å¦‚ ScrollViewï¼‰ã€‚</em></p>
<h5><a id="22__onDraw_631"></a>2.2 åœ¨é‡å†™çš„æ–¹æ³•æœ‰å¤šä¸ªé€‰æ‹©æ—¶ï¼Œä¼˜å…ˆé€‰æ‹© onDraw()</h5>
<p><em>ä¸€æ®µç»˜åˆ¶ä»£ç å†™åœ¨ä¸åŒçš„ç»˜åˆ¶æ–¹æ³•ä¸­æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œè¿™æ—¶ä½ å¯ä»¥é€‰ä¸€ä¸ªè‡ªå·±å–œæ¬¢æˆ–è€…ä¹ æƒ¯çš„ç»˜åˆ¶æ–¹æ³•æ¥é‡å†™ã€‚ä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šå¦‚æœç»˜åˆ¶ä»£ç æ—¢å¯ä»¥å†™åœ¨ onDraw() é‡Œï¼Œä¹Ÿå¯ä»¥å†™åœ¨å…¶ä»–ç»˜åˆ¶æ–¹æ³•é‡Œï¼Œé‚£ä¹ˆä¼˜å…ˆå†™åœ¨ onDraw() ï¼Œå› ä¸º Android æœ‰ç›¸å…³çš„ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦é‡ç»˜çš„æ—¶å€™è‡ªåŠ¨è·³è¿‡ onDraw() çš„é‡å¤æ‰§è¡Œï¼Œä»¥æå‡å¼€å‘æ•ˆç‡ã€‚äº«å—è¿™ç§ä¼˜åŒ–çš„åªæœ‰ onDraw() ä¸€ä¸ªæ–¹æ³•ã€‚</em></p>
<h3><a id="ActivityView_635"></a>å…«ã€åœ¨Activityä¸­è·å–Viewçš„å®½é«˜çš„å‡ ç§æ–¹å¼</h3>
<blockquote>
<p>Activity è·å– view çš„å®½é«˜ï¼Œ åœ¨ onCreate , onResume ç­‰æ–¹æ³•ä¸­è·å–åˆ°çš„éƒ½æ˜¯0ï¼Œ å› ä¸º View çš„æµ‹é‡è¿‡ç¨‹å¹¶ä¸æ˜¯å’Œ Activity çš„å£°æ˜å‘¨æœŸåŒæ­¥æ‰§è¡Œçš„</p>
</blockquote>
<p><strong>1. view.post</strong> post å¯ä»¥å°†ä¸€ä¸ª runnable æŠ•é€’åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œç„¶åç­‰å¾… Looper è°ƒç”¨æ­¤ runnable çš„æ—¶å€™ï¼Œ View ä¹Ÿå·²ç»åˆå§‹åŒ–å¥½äº†</p>
<pre><code>       view.post(new Runnable() {
            @Override
            public void run() {
                int width = view.getMeasuredWidth();
                int height = view.getMeasuredHeight(); 
            }
        });
</code></pre>
<p><strong>2. ViewTreeObserver</strong> ä½¿ç”¨ addOnGlobalLayoutListener æ¥å£ï¼Œ å½“ view æ ‘çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æˆ–è€… View æ ‘å†…éƒ¨çš„ view çš„å¯è§æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼Œ onGlobalLayout éƒ½ä¼šè¢«è°ƒç”¨ï¼Œ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ <strong>onGlobalLayout æ–¹æ³•å¯èƒ½è¢«è°ƒç”¨å¤šæ¬¡</strong>ï¼Œ ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code> view.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
            @Override
            public void onGlobalLayout() {
                view.getViewTreeObserver().removeOnGlobalLayoutListener(this);
                int width = view.getMeasuredWidth();
                int height = view.getMeasuredHeight();
            }
        });
</code></pre>
<p><strong>3. onWindowFocusChanged</strong> è¿™ä¸ªæ–¹æ³•çš„å«ä¹‰æ˜¯ View å·²ç»åˆå§‹åŒ–å®Œæ¯•äº†ï¼Œ å®½é«˜å·²ç»å‡†å¤‡å¥½äº†ï¼Œ éœ€è¦æ³¨æ„çš„å°±æ˜¯è¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡ï¼Œ åœ¨ Activity <code>onResume</code> å’Œ<code>onPause</code>çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ï¼Œ <strong>ä¹Ÿä¼šæœ‰å¤šæ¬¡è°ƒç”¨çš„æƒ…å†µ</strong></p>
<pre><code>     @Override
    public void onWindowFocusChanged(boolean hasWindowFocus) {
        super.onWindowFocusChanged(hasWindowFocus);
        if(hasWindowFocus){
            int width = view.getMeasuredWidth();
            int height = view.getMeasuredHeight();
        }
    }
</code></pre>
<p>èŠ‚é€‰è‡ªï¼šæœªæ‰¬å¸†çš„å°èˆ¹https://juejin.im/post/5dde44dc5188250e8b235d83</p>
<h1><a id="_677"></a>æœ€å</h1>
<p>é¢˜å¤–è¯ï¼Œè™½ç„¶æˆ‘åœ¨é˜¿é‡Œå·¥ä½œæ—¶é—´ä¸é•¿ï¼Œä½†ä¹ŸæŒ‡å¯¼è¿‡ä¸å°‘åŒè¡Œã€‚å¾ˆå°‘è·Ÿå¤§å®¶ä¸€èµ·æ¢è®¨ï¼Œä»Šå¹´æ˜¥èŠ‚å—æ­¦æ±‰æ–°å‹å† çŠ¶ç—…æ¯’å½±å“ï¼Œå¤§å®¶éƒ½åªèƒ½åœ¨å®¶åŠå…¬å­¦ä¹ ï¼Œå¾…ç–«æƒ…è¿‡å»ï¼Œå¤§å®¶é‡å½’å·¥ä½œå²—ä½ï¼Œé¢è¯•å’Œå²—ä½æµåŠ¨å¤šèµ·æ¥ï¼Œå› æ­¤å……åˆ†åˆ©ç”¨è¿™æ®µæ—¶é—´å¤ä¹ ï¼Œæœªæ¥åœ¨å¯»æ‰¾å·¥ä½œè¿‡ç¨‹ä¸­å é¢†æœ‰åˆ©ä½ç½®å°±æ˜¾å¾—å°¤ä¸ºé‡è¦äº†ã€‚<br>
åœ¨è¿™é‡Œæˆ‘åˆ†äº«ä¸¤æœ¬ç”±æˆ‘ä»¬é˜¿é‡ŒåŒäº‹æ€»ç»“ã€ŠAndroidé¢è¯•æŒ‡å¯¼ã€‹ï¼Œä»¥åŠã€ŠAndroidæ¶æ„å¸ˆé¢è¯•é¢˜ç²¾ç¼–è§£æå¤§å…¨ã€‹ä¸¤æœ¬ç”µå­ä¹¦åˆ†äº«ç»™è¯»è€…ï¼Œéœ€è¦çš„æœ‹å‹ï¼Œç‚¹å‡»ä¸‹æ–¹é“¾æ¥ï¼Œå‰å¾€å…è´¹é¢†å–ï¼</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0xMmMxNGI0NmNjNDAyMWI2LnBuZw?x-oss-process=image/format,png" alt="ã€ŠAndroidé¢è¯•æŒ‡å¯¼ã€‹"><br>
<strong>ä¸‹è½½åœ°å€ï¼š<a href="https://shimo.im/docs/3Tvytq686Yyv83KX/read" rel="nofollow">https://shimo.im/docs/3Tvytq686Yyv83KX/read</a></strong><br>
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0wZDhjOTNjZDAzNmNhZmEyLnBuZw?x-oss-process=image/format,png" alt="ã€ŠAndroidæ¶æ„å¸ˆé¢è¯•é¢˜ç²¾ç¼–è§£æå¤§å…¨ã€‹"><br>
<strong>ä¸‹è½½åœ°å€ï¼š<a href="https://shimo.im/docs/3Tvytq686Yyv83KX/read" rel="nofollow">https://shimo.im/docs/3Tvytq686Yyv83KX/read</a></strong></p>

                                    </div>
                <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-60ecaf1f42.css" rel="stylesheet">
                                                <div class="more-toolbox">
                <div class="left-toolbox">
                    <ul class="toolbox-list">
                        
                        <li class="tool-item tool-active is-like "><a href="javascript:;"><svg class="icon" aria-hidden="true">
                            <use xlink:href="#csdnc-thumbsup"></use>
                        </svg><span class="name">ç‚¹èµ</span>
                        <span class="count"></span>
                        </a></li>
                        <li class="tool-item tool-active is-collection "><a href="javascript:;" data-report-click='{"mod":"popu_824"}'><svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-csdnc-Collection-G" ></use>
                        </svg><span class="name">æ”¶è—</span></a></li>
                        <li class="tool-item tool-active is-share"><a href="javascript:;" data-report-click='{"mod":"1582594662_002"}'><svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-csdnc-fenxiang"></use>
                        </svg>åˆ†äº«</a></li>
                        <!--æ‰“èµå¼€å§‹-->
                                                <!--æ‰“èµç»“æŸ-->
                                                <li class="tool-item tool-more">
                            <a>
                            <svg t="1575545411852" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5717" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style>
</head>
<body>
<div style="width:852px;margin:0 auto;">
<div class="blog-content-box">
    <div class="article-header-box">
        <div class="article-header">
            <div class="article-title-box">
                <h1 class="title-article">é˜¿é‡Œé¢è¯•å®˜ï¼š è‡ªå®šä¹‰Viewè·Ÿç»˜åˆ¶æµç¨‹ç›¸å…³çŸ¥è¯†ç‚¹ï¼Ÿï¼ˆæ ‡å‡†å‚è€ƒè§£ç­”ï¼Œå€¼å¾—æ”¶è—ï¼‰</h1>
            </div>
            <div class="article-info-box">
                <div class="article-bar-top">
                    <!--æ–‡ç« ç±»å‹-->
                    <span class="article-type type-1 float-left">åŸåˆ›</span>                                                                                                                                            <a class="follow-nickName" href="https://me.csdn.net/weixin_43901866" target="_blank" rel="noopener">Android Developer</a>
                    <span class="time">æœ€åå‘å¸ƒäº2020-02-12 09:51:14                    </span>
                    <span class="read-count">é˜…è¯»æ•° 96</span>
                    <a id='blog_detail_zk_collection' class="un-collection" data-report-click='{"mod":"popu_823"}'>
                        <svg class="icon">
                            <use xlink:href="#icon-csdnc-Collection-G" ></use>
                        </svg>
                        <span>æ”¶è—</span>
                    </a>
                                    </div>
                                <div class="up-time">å‘å¸ƒäº2020-02-12 09:51:14</div>
                <div class="slide-content-box">
                                                        <div class="tags-box artic-tag-box">
                           <span class="label">åˆ†ç±»ä¸“æ ï¼š</span>
                                                                                             <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9337526.html">
                                       é˜¿é‡Œ                                   </a>
                                                                                                                            <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9415988.html">
                                       é¢è¯•                                   </a>
                                                                                                                            <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9439978.html">
                                       å­¦ä¹ èµ„æ–™                                   </a>
                                                                                  </div>
                                                                                                           <div class="article-copyright">
                        <span class="creativecommons">
                            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"></a>
                            <span>
                                ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œéµå¾ª<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 BY-SA </a>ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚                            </span>
                            <div class="article-source-link2222">
                                æœ¬æ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_43901866/article/details/104273790">https://blog.csdn.net/weixin_43901866/article/details/104273790</a>
                            </div>
                        </span> 
                        </div>
                                                                                </div>
                <div class="operating">
                                                                <a class="href-article-edit slide-toggle">å±•å¼€</a>
                                    </div>
            </div>
        </div>
    </div>
    <article class="baidu_pl">
        <!--pythonå®‰è£…æ‰‹å†Œå¼€å§‹-->
                <!--pythonå®‰è£…æ‰‹å†Œç»“æŸ-->
                <!--####ä¸“æ å¹¿å‘Šä½å›¾æ–‡åˆ‡æ¢å¼€å§‹-->
                                    <!--####ä¸“æ å¹¿å‘Šä½å›¾æ–‡åˆ‡æ¢ç»“æŸ-->
         <div id="article_content" class="article_content clearfix">
            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-833878f763.css" />
                            <div id="content_views" class="markdown_views prism-atom-one-dark">
                    <!-- flowchart ç®­å¤´å›¾æ ‡ å‹¿åˆ  -->
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                                            <blockquote>
<p>æœ¬æ–‡ç”¨äºè®°å½•è‡ªå®šä¹‰Viewçš„åŸºç¡€æ­¥éª¤ä»¥åŠä¸€äº›åŸºç¡€çš„ä¿¡æ¯ï¼ŒåæœŸå¯èƒ½é’ˆå¯¹å…·ä½“çš„ç‚¹å†™ä¸€äº›è¡¥å……æ€§çš„æ–‡ç« ã€‚</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0zNGIzZGJhYjUyNDllZDc2LnBuZw?x-oss-process=image/format,png" alt=""></p>
</blockquote>
<h3><a id="_View_8"></a>ä¸€ ã€Viewä¸­å…³äºå››ä¸ªæ„é€ å‡½æ•°å‚æ•°</h3>
<p>è‡ªå®šä¹‰Viewä¸­Viewçš„æ„é€ å‡½æ•°æœ‰å››ä¸ª</p>
<pre><code>//  ä¸»è¦æ˜¯åœ¨javaä»£ç ä¸­ç”Ÿå‘½ä¸€ä¸ªViewæ—¶æ‰€è°ƒç”¨ï¼Œæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œä¸€ä¸ªç©ºçš„Viewå¯¹è±¡
    public ChildrenView(Context context) {
        super(context);
    }
// åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨è¯¥è‡ªå®šä¹‰viewçš„æ—¶å€™ä¼šè°ƒç”¨åˆ°ï¼Œä¸€èˆ¬ä¼šè°ƒç”¨åˆ°è¯¥æ–¹æ³•
    public ChildrenView(Context context, AttributeSet attrs) {
        this(context, attrsï¼Œ0);
    }
//å¦‚æœä½ ä¸éœ€è¦Viewéšç€ä¸»é¢˜å˜åŒ–è€Œå˜åŒ–ï¼Œåˆ™ä¸Šé¢ä¸¤ä¸ªæ„é€ å‡½æ•°å°±å¯ä»¥äº†
//ä¸‹é¢ä¸¤ä¸ªæ˜¯ä¸ä¸»é¢˜ç›¸å…³çš„æ„é€ å‡½æ•°
   public ChildrenView(Context context, AttributeSet attrs, int defStyleAttr) {
        this(context, attrs, defStyleAttr, 0);
    }
//
    public ChildrenView(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) {
        super(context, attrs, defStyleAttr, defStyleRes);
    }
</code></pre>
<p>å››ä¸ªå‚æ•°è§£é‡Šï¼š</p>
<p><strong>context</strong>:ä¸Šä¸‹æ–‡</p>
<p><strong>AttributeSet attrs</strong>ï¼šä»xmlä¸­å®šä¹‰çš„å‚æ•°</p>
<p><strong>intdefStyleAttr</strong>ï¼šä¸»é¢˜ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å±æ€§</p>
<p><strong>intdefStyleRes</strong>ï¼š ä¼˜å…ˆçº§æ¬¡ä¹‹çš„å†…ç½®äºViewçš„style(è¿™é‡Œå°±æ˜¯è‡ªå®šä¹‰Viewè®¾ç½®æ ·å¼çš„åœ°æ–¹)</p>
<blockquote>
<ul>
<li><strong>å¤šä¸ªåœ°æ–¹å®šä¹‰å±æ€§ï¼Œä¼˜å…ˆçº§æ’åº</strong> Xmlç›´æ¥å®šä¹‰ &gt; xmlä¸­styleå¼•ç”¨ &gt; defStyleAttr&gt;defStyleRes &gt; themeç›´æ¥å®šä¹‰ (å‚è€ƒæ–‡ç« ï¼š<a href="https://www.jianshu.com/p/7389287c04bb" rel="nofollow">www.jianshu.com/p/7389287c0â€¦</a>)</li>
</ul>
</blockquote>
<h3><a id="_44"></a>äºŒã€è‡ªå®šä¹‰å±æ€§è¯´æ˜</h3>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0wYmYyNGM2ZTkzN2Q4ZDFhLnBuZw?x-oss-process=image/format,png" alt=""></p>
<p>é™¤äº†åŸºæœ¬ç±»å‹çš„ä¸è¯´ è®²ä¸€ä¸‹å…¶å®ƒå‡ ä¸ªå§ï¼š</p>
<ul>
<li>
<p>color ï¼šå¼•ç”¨é¢œè‰²</p>
</li>
<li>
<p>dimension: å¼•ç”¨å­—ä½“å¤§å°</p>
</li>
</ul>
<pre><code>//å®šä¹‰
&lt;attr name = "text_size" format = "dimension" /&gt;
//ä½¿ç”¨ï¼š
    app:text_size = "28sp" 
æˆ–è€… 
    app:text_size = "@android:dimen/app_icon_size"
</code></pre>
<ul>
<li>enumï¼šæšä¸¾å€¼</li>
</ul>
<pre><code>//å®šä¹‰
    &lt;attr name="orientation"&gt;
        &lt;enum name="horizontal" value="0" /&gt;
        &lt;enum name="vertical" value="1" /&gt;
    &lt;/attr&gt;
//ä½¿ç”¨ï¼š
    app:orientation = "vertical"
</code></pre>
<ul>
<li>flags:æ ‡å¿— ï¼ˆä½æˆ–è¿è¡Œï¼‰ ä¸»è¦ä½œç”¨=å¯ä»¥å¤šä¸ªå€¼</li>
</ul>
<pre><code>//å®šä¹‰
  &lt;attr name="gravity"&gt;
            &lt;flag name="top" value="0x01" /&gt;
            &lt;flag name="bottom" value="0x02" /&gt;
            &lt;flag name="left" value="0x04" /&gt;
            &lt;flag name="right" value="0x08" /&gt;
            &lt;flag name="center_vertical" value="0x16" /&gt;
    &lt;/attr&gt;
// ä½¿ç”¨
app:gravity = Top|left
</code></pre>
<ul>
<li>fraction:ç™¾åˆ†æ•°ï¼š</li>
</ul>
<pre><code>//å®šä¹‰ï¼š
&lt;attr name = "transparency" format = "fraction" /&gt;
//ä½¿ç”¨ï¼š
  app:transparency = "80%" 
</code></pre>
<ul>
<li>reference:å‚è€ƒ/å¼•ç”¨æŸä¸€èµ„æºID</li>
</ul>
<pre><code>//å®šä¹‰ï¼š
 &lt;attr name="leftIcon" format="reference" /&gt;
//ä½¿ç”¨ï¼š
app:leftIcon = "@drawable/å›¾ç‰‡ID"
</code></pre>
<ul>
<li>æ··åˆç±»å‹ï¼šå±æ€§å®šä¹‰æ—¶æŒ‡å®šå¤šç§ç±»å‹å€¼</li>
</ul>
<pre><code>//å±æ€§å®šä¹‰
 &lt;attr name = "background" format = "reference|color" /&gt;
//ä½¿ç”¨
android:background = "@drawable/å›¾ç‰‡ID" 
//æˆ–è€…
android:background = "#FFFFFF" 
</code></pre>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi1mZDE4ZGMxYzA0ZTc0ZGE5LnBuZw?x-oss-process=image/format,png" alt=""></p>
<h3><a id="_121"></a>ä¸‰ã€è‡ªå®šä¹‰æ§ä»¶ç±»å‹</h3>
<ul>
<li>
<h4><a id="_123"></a>è‡ªå®šä¹‰ç»„åˆæ§ä»¶æ­¥éª¤</h4>
</li>
</ul>
<h5><a id="1__125"></a>1. è‡ªå®šä¹‰å±æ€§</h5>
<p>åœ¨<code>res/values</code>ç›®å½•ä¸‹çš„<code>attrs.xml</code>æ–‡ä»¶ä¸­</p>
<pre><code>&lt;resources&gt;
&lt;declare-styleable name="CustomView"&gt;
        &lt;attr name="leftIcon" format="reference" /&gt;
        &lt;attr name="state" format="boolean"/&gt;
        &lt;attr name="name" format="string"/&gt;
    &lt;/declare-styleable&gt;
&lt;/resources&gt;
</code></pre>
<h5><a id="2__139"></a>2. å¸ƒå±€ä¸­ä½¿ç”¨è‡ªå®šä¹‰å±æ€§</h5>
<p>åœ¨å¸ƒå±€ä¸­ä½¿ç”¨</p>
<pre><code>&lt;com.myapplication.view.CustomView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                app:leftIcon="@mipmap/ic_temp"
                app:name="æ¸©åº¦"
                app:state="false" /&gt;
</code></pre>
<h5><a id="3_view_152"></a>3. viewçš„æ„é€ å‡½æ•°è·å–è‡ªå®šä¹‰å±æ€§</h5>
<pre><code>class DigitalCustomView : LinearLayout {
    constructor(context: Context) : super(context)
    constructor(context: Context, attrs: AttributeSet?) : super(context, attrs) {
        LayoutInflater.from(context).inflate(R.layout.view_custom, this)
        var ta = context.obtainStyledAttributes(attrs, R.styleable.CustomView)
        mIcon = ta.getResourceId(R.styleable.CustomView_leftIcon, -1) //å·¦å›¾åƒ
        mState = ta.getBoolean(R.styleable.DigitalCustomView_state, false)
        mName = ta.getString(R.styleable.CustomView_name)
        ta.recycle()
        initView()
    }

}
</code></pre>
<p>ä¸Šé¢ç»™å‡ºå¤§è‡´çš„ä»£ç  è®°å¾—è·å–<code>context.obtainStyledAttributes(attrs, R.styleable.CustomView)</code>æœ€åè¦è°ƒç”¨<code>ta.recycle()</code>åˆ©ç”¨å¯¹è±¡æ± å›æ”¶taåŠ ä»¥å¤ç”¨</p>
<ul>
<li>
<h4><a id="_172"></a>ç»§æ‰¿ç³»ç»Ÿæ§ä»¶</h4>
</li>
</ul>
<p>å°±æ˜¯ç»§æ‰¿ç³»ç»Ÿå·²ç»æä¾›å¥½ç»™æˆ‘ä»¬çš„æ§ä»¶ä¾‹å¦‚TextViewã€LinearLayoutç­‰,åˆ†ä¸ºViewç±»å‹æˆ–è€…ViewGroupç±»å‹çš„ä¸¤ç§ã€‚ä¸»è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œå®ç°ï¼Œå®ç°é‡å†™çš„ç©ºé—´ä¹Ÿå¾ˆå¤§ ä¸»è¦çœ‹éœ€æ±‚ã€‚</p>
<p>æ¯”å¦‚éœ€æ±‚ ï¼šåœ¨æ–‡å­—åé¢åŠ ä¸ªé¢œè‰²èƒŒæ™¯</p>
<p>æ ¹æ®éœ€è¦ä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯å¸Œæœ›å¯ä»¥å¤ç”¨ç³»ç»Ÿçš„<code>onMeaseur</code>å’Œ<code>onLayout</code>æµç¨‹.ç›´æ¥å¤å†™<code>onDraw</code>æ–¹æ³•</p>
<pre><code>class Practice02BeforeOnDrawView : AppCompatTextView {
    internal var paint = Paint(Paint.ANTI_ALIAS_FLAG)
    internal var bounds = RectF()

    constructor(context: Context) : super(context) {}

    constructor(context: Context, attrs: AttributeSet?) : super(context, attrs) {}

    constructor(context: Context, attrs: AttributeSet?, defStyleAttr: Int) : super(context, attrs, defStyleAttr) {}

    init {
        paint.color = Color.parseColor("#FFC107")
    }

    override fun onDraw(canvas: Canvas) {
        // æŠŠä¸‹é¢çš„ç»˜åˆ¶ä»£ç ç§»åˆ° super.onDraw() çš„ä¸Šé¢ï¼Œå°±å¯ä»¥è®©åŸä¸»ä½“å†…å®¹ç›–ä½ä½ çš„ç»˜åˆ¶ä»£ç äº†
        // ï¼ˆæˆ–è€…ä½ ä¹Ÿå¯ä»¥æŠŠ super.onDraw() ç§»åˆ°è¿™æ®µä»£ç çš„ä¸‹é¢ï¼‰
        val layout = layout
        bounds.left = layout.getLineLeft(1)
        bounds.right = layout.getLineRight(1)
        bounds.top = layout.getLineTop(1).toFloat()
        bounds.bottom = layout.getLineBottom(1).toFloat()
       //ç»˜åˆ¶æ–¹å½¢èƒŒæ™¯
        canvas.drawRect(bounds, paint)
        super.onDraw(canvas)
    }
}
</code></pre>
<blockquote>
<p>è¿™é‡Œä¼šæ¶‰åŠåˆ°ç”»ç¬”<code>Paint()</code>ã€ç”»å¸ƒ<code>canvas</code>ã€è·¯å¾„<code>Path</code>ã€ç»˜ç”»é¡ºåºç­‰çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œåé¢å†è¯¦ç»†è¯´æ˜</p>
</blockquote>
<ul>
<li>
<h4><a id="View_212"></a>ç›´æ¥ç»§æ‰¿View</h4>
</li>
</ul>
<p>è¿™ç§å°±æ˜¯ç±»ä¼¼TextViewç­‰ï¼Œä¸éœ€è¦å»è½®è®­å­<code>View</code>åªéœ€è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚é‡å†™<code>onMeasure()</code>ã€<code>onLayout()</code>ã€<code>onDraw()</code>ç­‰æ–¹æ³•ä¾¿å¯ä»¥ï¼Œè¦æ³¨æ„ç‚¹å°±æ˜¯è®°å¾—<code>Padding</code>ç­‰å€¼è¦è®°å¾—åŠ å…¥è¿ç®—</p>
<pre><code> private int getCalculateSize(int defaultSize, int measureSpec) {
        int finallSize = defaultSize;

        int mode = MeasureSpec.getMode(measureSpec);
        int size = MeasureSpec.getSize(measureSpec);
     //  æ ¹æ®æ¨¡å¼å¯¹
        switch (mode) {
            case MeasureSpec.EXACTLY: {
              ...
                break;
            }
            case MeasureSpec.AT_MOST: {
                ...
                break;
            }
            case MeasureSpec.UNSPECIFIED: {
               ...
                break;
            }
        }
        return finallSize;
}

@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        super.onMeasure(widthMeasureSpec, heightMeasureSpec);
        int width = getCalculateSize(120, widthMeasureSpec);
        int height = getCalculateSize(120, heightMeasureSpec);
        setMeasuredDimension(width, height);
}

  //ç”»ä¸€ä¸ªåœ†
    @Override
    protected void onDraw(Canvas canvas) {
        //è°ƒç”¨çˆ¶Viewçš„onDrawå‡½æ•°ï¼Œå› ä¸ºViewè¿™ä¸ªç±»å¸®æˆ‘ä»¬å®ç°äº†ä¸€äº›åŸºæœ¬çš„è€Œç»˜åˆ¶åŠŸèƒ½ï¼Œæ¯”å¦‚ç»˜åˆ¶èƒŒæ™¯é¢œè‰²ã€èƒŒæ™¯å›¾ç‰‡ç­‰
        super.onDraw(canvas);
        int r = getMeasuredWidth() / 2;
        //åœ†å¿ƒçš„æ¨ªåæ ‡ä¸ºå½“å‰çš„Viewçš„å·¦è¾¹èµ·å§‹ä½ç½®+åŠå¾„
        int centerX = getLeft() + r;
        //åœ†å¿ƒçš„çºµåæ ‡ä¸ºå½“å‰çš„Viewçš„é¡¶éƒ¨èµ·å§‹ä½ç½®+åŠå¾„
        int centerY = getTop() + r;

        Paint paint = new Paint();
        paint.setColor(Color.RED);
        canvas.drawCircle(centerX, centerY, r, paint);
    }

</code></pre>
<ul>
<li>
<h4><a id="ViewGroup_266"></a>ç›´æ¥ç»§æ‰¿ViewGroup</h4>
</li>
</ul>
<p>ç±»ä¼¼å®ç°LinearLayoutç­‰ï¼Œå¯ä»¥å»çœ‹é‚£ä¸€ä¸‹LinearLayoutçš„å®ç° åŸºæœ¬çš„ä½ å¯èƒ½è¦é‡å†™<code>onMeasure()</code>ã€<code>onLayout()</code>ã€<code>onDraw()</code>æ–¹æ³•,è¿™å—å¾ˆå¤šé—®é¢˜è¦å¤„ç†åŒ…æ‹¬è½®è®­<code>childView</code>çš„æµ‹é‡å€¼ä»¥åŠæ¨¡å¼è¿›è¡Œå¤§å°é€»è¾‘è®¡ç®—ç­‰ï¼Œè¿™ä¸ªç¯‡å¹…è¿‡å¤§åæœŸåŠ å¤šä¸ªæ–‡ç« å†™è¯¦ç»†çš„</p>
<p>è¿™é‡Œå†™ä¸ªç®€å•çš„éœ€æ±‚ï¼Œæ¨¡ä»¿<code>LinearLayout</code>çš„å‚ç›´å¸ƒå±€</p>
<pre><code>class CustomViewGroup :ViewGroup{

    constructor(context:Context):super(context)
    constructor(context: Context,attrs:AttributeSet):super(context,attrs){
            //å¯è·å–è‡ªå®šä¹‰çš„å±æ€§ç­‰
    }
    override fun onMeasure(widthMeasureSpec: Int, heightMeasureSpec: Int) {
        super.onMeasure(widthMeasureSpec, heightMeasureSpec)
        //å°†æ‰€æœ‰çš„å­Viewè¿›è¡Œæµ‹é‡ï¼Œè¿™ä¼šè§¦å‘æ¯ä¸ªå­Viewçš„onMeasureå‡½æ•°
        measureChildren(widthMeasureSpec, heightMeasureSpec)
        val widthMode = MeasureSpec.getMode(widthMeasureSpec)
        val widthSize = MeasureSpec.getSize(widthMeasureSpec)
        val heightMode = MeasureSpec.getMode(heightMeasureSpec)
        val heightSize = MeasureSpec.getSize(heightMeasureSpec)
        val childCount = childCount
        if (childCount == 0) {
            //æ²¡æœ‰å­Viewçš„æƒ…å†µ
            setMeasuredDimension(0, 0)
        } else {
            //å¦‚æœå®½é«˜éƒ½æ˜¯åŒ…è£¹å†…å®¹
            if (widthMode == MeasureSpec.AT_MOST &amp;&amp; heightMode == MeasureSpec.AT_MOST) {
                //æˆ‘ä»¬å°†é«˜åº¦è®¾ç½®ä¸ºæ‰€æœ‰å­Viewçš„é«˜åº¦ç›¸åŠ ï¼Œå®½åº¦è®¾ä¸ºå­Viewä¸­æœ€å¤§çš„å®½åº¦
                val height = getTotalHeight()
                val width = getMaxChildWidth()
                setMeasuredDimension(width, height)
            } else if (heightMode == MeasureSpec.AT_MOST) {
                //å¦‚æœåªæœ‰é«˜åº¦æ˜¯åŒ…è£¹å†…å®¹
                //å®½åº¦è®¾ç½®ä¸ºViewGroupè‡ªå·±çš„æµ‹é‡å®½åº¦ï¼Œé«˜åº¦è®¾ç½®ä¸ºæ‰€æœ‰å­Viewçš„é«˜åº¦æ€»å’Œ
                setMeasuredDimension(widthSize, getTotalHeight())
            } else if (widthMode == MeasureSpec.AT_MOST) {//å¦‚æœåªæœ‰å®½åº¦æ˜¯åŒ…è£¹å†…å®¹
                //å®½åº¦è®¾ç½®ä¸ºå­Viewä¸­å®½åº¦æœ€å¤§çš„å€¼ï¼Œé«˜åº¦è®¾ç½®ä¸ºViewGroupè‡ªå·±çš„æµ‹é‡å€¼
                setMeasuredDimension(getMaxChildWidth(), heightSize)

            }
        }
    /***
     * è·å–å­Viewä¸­å®½åº¦æœ€å¤§çš„å€¼
     */
    private fun getMaxChildWidth(): Int {
        val childCount = childCount
        var maxWidth = 0
        for (i in 0 until childCount) {
            val childView = getChildAt(i)
            if (childView.measuredWidth &gt; maxWidth)
                maxWidth = childView.measuredWidth

        }
        return maxWidth
    }

    /***
     * å°†æ‰€æœ‰å­Viewçš„é«˜åº¦ç›¸åŠ 
     */
    private fun getTotalHeight(): Int {
        val childCount = childCount
        var height = 0
        for (i in 0 until childCount) {
            val childView = getChildAt(i)
            height += childView.measuredHeight

        }

        return height
    }

    }

    override fun onLayout(changed: Boolean, l: Int, t: Int, r: Int, b: Int) {
        val count = childCount
        var currentHeight = t
        for (i in 0 until count) {
            val child = getChildAt(i)
            val h = child.measuredHeight
            val w = child.measuredWidth
            //æ‘†æ”¾å­view
            child.layout(l, currentHeight, l + w, currentHeight + h)
            currentHeight += h
        }
    }
}
</code></pre>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi03MzdlOWMxNmNjNjM0OTYzLnBuZw?x-oss-process=image/format,png" alt=""></p>
<blockquote>
<p>ä¸»è¦ä¸¤ç‚¹ å…ˆ <code>measureChildren()</code>è½®è®­éå†å­<code>View</code>è·å–å®½é«˜,å¹¶æ ¹æ®æµ‹é‡æ¨¡å¼é€»è¾‘è®¡ç®—æœ€åæ‰€æœ‰çš„æ§ä»¶çš„æ‰€éœ€å®½é«˜ï¼Œæœ€å<code>setMeasuredDimension()</code>ä¿å­˜ä¸€ä¸‹ ###å››ã€ Viewçš„ç»˜åˆ¶æµç¨‹ç›¸å…³ æœ€åŸºæœ¬çš„ä¸‰ä¸ªç›¸å…³å‡½æ•° <code>measure()</code> -&gt;<code>layout()</code>-&gt;<code>draw()</code></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi1hOWQzNzE0MjUxZWY2NzQzLnBuZw?x-oss-process=image/format,png" alt=""></p>
</blockquote>
<h3><a id="onMeasure_362"></a>äº”ã€onMeasure()ç›¸å…³çš„çŸ¥è¯†ç‚¹</h3>
<h4><a id="1_MeasureSpec_364"></a>1. MeasureSpec</h4>
<p><code>MeasureSpec</code>æ˜¯<code>View</code>çš„å†…éƒ¨ç±»ï¼Œå®ƒå°è£…äº†ä¸€ä¸ª<code>View</code>çš„å°ºå¯¸ï¼Œåœ¨<code>onMeasure()</code>å½“ä¸­ä¼šæ ¹æ®è¿™ä¸ª<code>MeasureSpec</code>çš„å€¼æ¥ç¡®å®š<code>View</code>çš„å®½é«˜ã€‚ <code>MeasureSpec</code> çš„æ•°æ®æ˜¯<code>int</code>ç±»å‹ï¼Œæœ‰<code>32</code>ä½ã€‚ é«˜ä¸¤ä½è¡¨ç¤ºæ¨¡å¼ï¼Œåé¢<code>30</code>ä½è¡¨ç¤ºå¤§å°<code>size</code>ã€‚åˆ™<code>MeasureSpec = mode+size</code> ä¸‰ç§æ¨¡å¼åˆ†åˆ«ä¸ºï¼š<code>EXACTLY</code>,<code>AT_MOST</code>,<code>UNSPECIFIED</code></p>
<blockquote>
<p><code>EXACTLY</code>: ï¼ˆ<code>match_parent</code>æˆ–è€… <code>ç²¾ç¡®æ•°æ®å€¼</code>ï¼‰ç²¾ç¡®æ¨¡å¼ï¼Œå¯¹åº”çš„æ•°å€¼å°±æ˜¯<code>MeasureSpec</code>å½“ä¸­çš„<code>size</code></p>
<p><code>AT_MOST</code>ğŸ˜¦<code>wrap_content)</code>æœ€å¤§å€¼æ¨¡å¼ï¼ŒViewçš„å°ºå¯¸æœ‰ä¸€ä¸ªæœ€å¤§å€¼ï¼Œ<code>View</code>ä¸è¶…è¿‡<code>MeasureSpec</code>å½“ä¸­çš„<code>Size</code>å€¼</p>
<p><code>UNSPECIFIED</code>ï¼šï¼ˆä¸€èˆ¬ç³»ç»Ÿä½¿ç”¨ï¼‰æ— é™åˆ¶æ¨¡å¼ï¼ŒViewè®¾ç½®å¤šå¤§å°±ç»™ä»–å¤šå¤§</p>
</blockquote>
<pre><code>//è·å–æµ‹é‡æ¨¡å¼
 val widthMode = MeasureSpec.getMode(widthMeasureSpec)
//è·å–æµ‹é‡å¤§å° 
val widthSize = MeasureSpec.getSize(widthMeasureSpec)
//é€šè¿‡Modeå’ŒSizeæ„é€ MeasureSpec
val measureSpec = MeasureSpec.makeMeasureSpec(size, mode);
</code></pre>
<h4><a id="2_View_onMeasure_383"></a>2. View #onMeasure()æºç </h4>
<pre><code>   protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),
                getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));
    }
    protected int getSuggestedMinimumWidth() {
        return (mBackground == null) ? mMinWidth : max(mMinWidth, mBackground.getMinimumWidth());
    }
    protected final void setMeasuredDimension(int measuredWidth, int measuredHeight) {
        boolean optical = isLayoutModeOptical(this);
        if (optical != isLayoutModeOptical(mParent)) {
            Insets insets = getOpticalInsets();
            int opticalWidth  = insets.left + insets.right;
            int opticalHeight = insets.top  + insets.bottom;

            measuredWidth  += optical ? opticalWidth  : -opticalWidth;
            measuredHeight += optical ? opticalHeight : -opticalHeight;
        }
        setMeasuredDimensionRaw(measuredWidth, measuredHeight);
    }
    public static int getDefaultSize(int size, int measureSpec) {
        int result = size;
        int specMode = MeasureSpec.getMode(measureSpec);
        int specSize = MeasureSpec.getSize(measureSpec);

        switch (specMode) {
        case MeasureSpec.UNSPECIFIED:
            result = size;
            break;
        case MeasureSpec.AT_MOST:
        case MeasureSpec.EXACTLY:
            result = specSize;
            break;
        }
        return result;
    }
    private void setMeasuredDimensionRaw(int measuredWidth, int measuredHeight) {
        mMeasuredWidth = measuredWidth;
        mMeasuredHeight = measuredHeight;

        mPrivateFlags |= PFLAG_MEASURED_DIMENSION_SET;
    }
</code></pre>
<ul>
<li>
<p><strong>setMeasuredDimension(int measuredWidth, int measuredHeight)</strong> ï¼šç”¨æ¥è®¾ç½®Viewçš„å®½é«˜ï¼Œåœ¨æˆ‘ä»¬è‡ªå®šä¹‰Viewä¿å­˜å®½é«˜ä¹Ÿä¼šè¦ç”¨åˆ°ã€‚</p>
</li>
<li>
<p><strong>getSuggestedMinimumWidth()</strong>ï¼šå½“Viewæ²¡æœ‰è®¾ç½®èƒŒæ™¯æ—¶ï¼Œé»˜è®¤å¤§å°å°±æ˜¯<code>mMinWidth</code>ï¼Œè¿™ä¸ªå€¼å¯¹åº”<code>Android:minWidth</code>å±æ€§ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®æ—¶é»˜è®¤ä¸º0. å¦‚æœæœ‰è®¾ç½®èƒŒæ™¯ï¼Œåˆ™é»˜è®¤å¤§å°ä¸º<code>mMinWidth</code>å’Œ<code>mBackground.getMinimumWidth()</code>å½“ä¸­çš„è¾ƒå¤§å€¼ã€‚</p>
</li>
<li>
<p><strong>getDefaultSize(int size, int measureSpec)</strong>ï¼šç”¨æ¥è·å–Viewé»˜è®¤çš„å®½é«˜ï¼Œåœ¨**getDefaultSize()**ä¸­å¯¹<code>MeasureSpec.AT_MOST</code>,<code>MeasureSpec.EXACTLY</code>ä¸¤ä¸ªçš„å¤„ç†æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰<code>View</code>çš„æ—¶å€™ è¦å¯¹ä¸¤ç§æ¨¡å¼è¿›è¡Œå¤„ç†ã€‚</p>
</li>
</ul>
<h4><a id="3_ViewGroupmeasureonMeasure_435"></a>3. ViewGroupä¸­å¹¶æ²¡æœ‰measure()ä¹Ÿæ²¡æœ‰onMeasure()</h4>
<p>å› ä¸ºViewGroupé™¤äº†æµ‹é‡è‡ªèº«çš„å®½é«˜ï¼Œè¿˜éœ€è¦æµ‹é‡å„ä¸ªå­<code>View</code>çš„å®½é«˜ï¼Œä¸åŒçš„å¸ƒå±€æµ‹é‡æ–¹å¼ä¸åŒ (ä¾‹å¦‚ <code>LinearLayout</code>è·Ÿ<code>RelativeLayout</code>ç­‰å¸ƒå±€ï¼‰,æ‰€ä»¥ç›´æ¥äº¤ç”±ç»§æ‰¿è€…æ ¹æ®è‡ªå·±çš„éœ€è¦å»å¤å†™ã€‚ä½†æ˜¯é‡Œé¢å› ä¸ºå­<code>View</code>çš„æµ‹é‡æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œæ‰€ä»¥é‡Œé¢å·²ç»æä¾›äº†åŸºæœ¬çš„<code>measureChildren()</code>ä»¥åŠ<code>measureChild()</code>æ¥å¸®åŠ©æˆ‘ä»¬å¯¹å­<code>View</code>è¿›è¡Œæµ‹é‡ è¿™ä¸ªå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘å¦ä¸€ç¯‡æ–‡ç« ï¼š<code>LinearLayout # onMeasure()</code><a href="https://www.jianshu.com/p/61efaa047ae4" rel="nofollow">LinearLayout onMeasureæºç é˜…è¯»</a></p>
<h3><a id="onLayout_439"></a>å…­ã€onLayout()ç›¸å…³</h3>
<blockquote>
<ol>
<li>View.javaçš„onLayoutæ–¹æ³•æ˜¯ç©ºå®ç°:å› ä¸ºå­Viewçš„ä½ç½®ï¼Œæ˜¯ç”±å…¶çˆ¶æ§ä»¶çš„onLayoutæ–¹æ³•æ¥ç¡®å®šçš„ã€‚</li>
<li>onLayout(int l, int t, int r, int b)ä¸­çš„å‚æ•°lã€tã€rã€béƒ½æ˜¯ç›¸å¯¹äºå…¶çˆ¶ æ§ä»¶çš„ä½ç½®ã€‚</li>
<li>è‡ªèº«çš„mLeft, mTop, mRight, mBottoméƒ½æ˜¯ç›¸å¯¹äºçˆ¶æ§ä»¶çš„ä½ç½®ã€‚</li>
</ol>
</blockquote>
<h4><a id="1_Android_445"></a>1. Androidåæ ‡ç³»</h4>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi1jNjhiYzMzN2Q5YWEyMmQwLnBuZw?x-oss-process=image/format,png" alt=""></p>
<h4><a id="2_View_450"></a>2. å†…éƒ¨Viewåæ ‡ç³»è·Ÿç‚¹å‡»åæ ‡</h4>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0wNmRlZGRiMGRmMjJkMWZhLnBuZw?x-oss-process=image/format,png" alt=""></p>
<h4><a id="3_Viewlayoutint_l_int_t_int_r_int_b_454"></a>3. çœ‹ä¸€ä¸‹View#layout(int l, int t, int r, int b)æºç </h4>
<pre><code>public void layout(int l, int t, int r, int b) {
        if ((mPrivateFlags3 &amp; PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT) != 0) {
            onMeasure(mOldWidthMeasureSpec, mOldHeightMeasureSpec);
            mPrivateFlags3 &amp;= ~PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;
        }

        int oldL = mLeft;
        int oldT = mTop;
        int oldB = mBottom;
        int oldR = mRight;

        boolean changed = isLayoutModeOptical(mParent) ?
                setOpticalFrame(l, t, r, b) : setFrame(l, t, r, b);

        if (changed || (mPrivateFlags &amp; PFLAG_LAYOUT_REQUIRED) == PFLAG_LAYOUT_REQUIRED) {
            onLayout(changed, l, t, r, b);
   //   ....çœç•¥å…¶å®ƒéƒ¨åˆ†
    }
  private boolean setOpticalFrame(int left, int top, int right, int bottom) {
        Insets parentInsets = mParent instanceof View ?
                ((View) mParent).getOpticalInsets() : Insets.NONE;
        Insets childInsets = getOpticalInsets();
        return setFrame(
                left   + parentInsets.left - childInsets.left,
                top    + parentInsets.top  - childInsets.top,
                right  + parentInsets.left + childInsets.right,
                bottom + parentInsets.top  + childInsets.bottom);
    }
  protected boolean setFrame(int left, int top, int right, int bottom) {
        boolean changed = false;
    // ....çœç•¥å…¶å®ƒéƒ¨åˆ†
        if (mLeft != left || mRight != right || mTop != top || mBottom != bottom) {
            changed = true;
            int drawn = mPrivateFlags &amp; PFLAG_DRAWN;
            int oldWidth = mRight - mLeft;
            int oldHeight = mBottom - mTop;
            int newWidth = right - left;
            int newHeight = bottom - top;
            boolean sizeChanged = (newWidth != oldWidth) || (newHeight != oldHeight);
            invalidate(sizeChanged);
            mLeft = left;
            mTop = top;
            mRight = right;
            mBottom = bottom;
            mRenderNode.setLeftTopRightBottom(mLeft, mTop, mRight, mBottom);
            mPrivateFlags |= PFLAG_HAS_BOUNDS;
            if (sizeChanged) {
                sizeChange(newWidth, newHeight, oldWidth, oldHeight);
            }
            if ((mViewFlags &amp; VISIBILITY_MASK) == VISIBLE || mGhostView != null) {
                mPrivateFlags |= PFLAG_DRAWN;
                invalidate(sizeChanged);
                invalidateParentCaches();
            }
            mPrivateFlags |= drawn;
            mBackgroundSizeChanged = true;
            mDefaultFocusHighlightSizeChanged = true;
            if (mForegroundInfo != null) {
                mForegroundInfo.mBoundsChanged = true;
            }
            notifySubtreeAccessibilityStateChangedIfNeeded();
        }
        return changed;
    }

</code></pre>
<p>å››ä¸ªå‚æ•°<code>lã€tã€rã€b</code>åˆ†åˆ«ä»£è¡¨<code>View</code>çš„å·¦ã€ä¸Šã€å³ã€ä¸‹å››ä¸ªè¾¹ç•Œç›¸å¯¹äºå…¶çˆ¶<code>View</code>çš„è·ç¦»ã€‚ åœ¨è°ƒç”¨<code>onLayout(changed, l, t, r, b);</code>ä¹‹å‰éƒ½ä¼šè°ƒç”¨åˆ°<code>setFrame()</code>ç¡®å®š<code>View</code>åœ¨çˆ¶å®¹å™¨å½“ä¸­çš„ä½ç½®ï¼Œèµ‹å€¼ç»™<code>mLeft</code>,<code>mTop</code>,<code>mRight</code>,<code>mBottom</code>ã€‚ åœ¨<code>ViewGroup#onLayout()</code>è·Ÿ<code>View#onLayout()</code>éƒ½æ˜¯ç©ºå®ç°ï¼Œäº¤ç»™ç»§æ‰¿è€…æ ¹æ®è‡ªèº«éœ€æ±‚å»å®šä½</p>
<blockquote>
<p>éƒ¨åˆ†é›¶æ•£çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li><strong><code>getMeasureWidth()</code>ä¸<code>getWidth()</code></strong> <code>getMeasureWidth()</code>è¿”å›çš„æ˜¯<code>mMeasuredWidth</code>ï¼Œè€Œè¯¥å€¼æ˜¯åœ¨<code>setMeasureDimension()</code>ä¸­çš„<code>setMeasureDimensionRaw()</code>ä¸­è®¾ç½®çš„ã€‚å› æ­¤<code>onMeasure()</code>åçš„æ‰€æœ‰æ–¹æ³•éƒ½èƒ½è·å–åˆ°è¿™ä¸ªå€¼ã€‚ <code>getWidth</code>è¿”å›çš„æ˜¯<code>mRight-mLeft</code>ï¼Œè¿™ä¸¤ä¸ªå€¼ï¼Œæ˜¯åœ¨<code>layout()</code>ä¸­çš„<code>setFrame()</code>ä¸­è®¾ç½®çš„. <code>getMeasureWidthAndState</code>ä¸­æœ‰ä¸€å¥ï¼š <code>This should be used during measurement and layout calculations only. Use {@link #getWidth()} to see how wide a view is after layout.</code></li>
</ul>
<p>æ€»ç»“ï¼šåªæœ‰åœ¨æµ‹é‡è¿‡ç¨‹ä¸­å’Œå¸ƒå±€è®¡ç®—æ—¶ï¼Œæ‰ç”¨<code>getMeasuredWidth()</code>ã€‚åœ¨layoutä¹‹åï¼Œç”¨<code>getWidth()</code>æ¥è·å–å®½åº¦</p>
</blockquote>
<h3><a id="draw_532"></a>ä¸ƒã€draw()ç»˜ç”»è¿‡ç¨‹</h3>
<pre><code> /*
         * Draw traversal performs several drawing steps which must be executed
         * in the appropriate order:
         *
         *      1\. Draw the background
         *      2\. If necessary, save the canvas' layers to prepare for fading
         *      3\. Draw view's content
         *      4\. Draw children
         *      5\. If necessary, draw the fading edges and restore layers
         *      6\. Draw decorations (scrollbars for instance)
         */
</code></pre>
<blockquote>
<p>ä¸Šé¢æ˜¯<code>draw()</code>é‡Œé¢å†™çš„ç»˜ç”»é¡ºåºã€‚</p>
<ol>
<li>ç»˜åˆ¶èƒŒæ™¯ã€‚</li>
<li>å¦‚æœå¿…è¦çš„è¯,ä¿å­˜å½“å‰<code>canvas</code></li>
<li>ç»˜åˆ¶<code>View</code>çš„å†…å®¹</li>
<li>ç»˜åˆ¶å­<code>View</code></li>
<li>å¦‚æœå¿…è¦çš„è¯,ç»˜ç”»è¾¹ç¼˜é‡æ–°ä¿å­˜å›¾å±‚</li>
<li>ç”»è£…é¥°(ä¾‹å¦‚æ»šåŠ¨æ¡)</li>
</ol>
</blockquote>
<h4><a id="1_Viewdraw_557"></a>1. çœ‹ä¸€ä¸‹View#draw()æºç çš„å®ç°</h4>
<pre><code>public void draw(Canvas canvas) {
  // Step 1, draw the background, if needed
        int saveCount;

        if (!dirtyOpaque) {
            drawBackground(canvas);
        }

        // skip step 2 &amp; 5 if possible (common case)
        final int viewFlags = mViewFlags;
        boolean horizontalEdges = (viewFlags &amp; FADING_EDGE_HORIZONTAL) != 0;
        boolean verticalEdges = (viewFlags &amp; FADING_EDGE_VERTICAL) != 0;
        if (!verticalEdges &amp;&amp; !horizontalEdges) {
            // Step 3, draw the content
            if (!dirtyOpaque) onDraw(canvas);

            // Step 4, draw the children
            dispatchDraw(canvas);

            drawAutofilledHighlight(canvas);

            // Overlay is part of the content and draws beneath Foreground
            if (mOverlay != null &amp;&amp; !mOverlay.isEmpty()) {
                mOverlay.getOverlayView().dispatchDraw(canvas);
            }

            // Step 6, draw decorations (foreground, scrollbars)
            onDrawForeground(canvas);

            // Step 7, draw the default focus highlight
            drawDefaultFocusHighlight(canvas);

            if (debugDraw()) {
                debugDrawFocus(canvas);
            }

            // we're done...
            return;
        }
}

</code></pre>
<p>ç”±ä¸Šé¢å¯ä»¥çœ‹åˆ° å…ˆè°ƒç”¨<code>drawBackground(canvas)</code> -&gt;<code>onDraw(canvas)</code>-&gt;<code>dispatchDraw(canvas)</code>-&gt;<code>onDrawForeground(canvas)</code>è¶Šæ˜¯åé¢ç»˜ç”»çš„è¶Šæ˜¯è¦†ç›–åœ¨æœ€ä¸Šå±‚ã€‚</p>
<p><strong>drawBackground(canvas)</strong>:ç”»èƒŒæ™¯ï¼Œä¸å¯é‡å†™</p>
<p><strong>onDraw(canvas)</strong>ï¼šç”»ä¸»ä½“</p>
<ul>
<li><strong>ä»£ç å†™åœ¨super.onDraw()å‰</strong>ï¼šä¼šè¢«çˆ¶ç±»çš„onDrawè¦†ç›–</li>
<li><strong>ä»£ç å†™åœ¨super.onDraw()å</strong>ï¼šä¸ä¼šè¢«çˆ¶ç±»çš„onDrawè¦†ç›–</li>
</ul>
<p><strong>dispatchDraw()</strong> ï¼šç»˜åˆ¶å­ View çš„æ–¹æ³•</p>
<ul>
<li>
<p><strong>ä»£ç å†™åœ¨super.dispatchDraw(canvas)å‰</strong>ï¼šæŠŠç»˜åˆ¶ä»£ç å†™åœ¨ super.dispatchDraw() çš„ä¸Šé¢ï¼Œè¿™æ®µç»˜åˆ¶å°±ä¼šåœ¨ onDraw() ä¹‹åã€ super.dispatchDraw() ä¹‹å‰å‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯ç»˜åˆ¶å†…å®¹ä¼šå‡ºç°åœ¨ä¸»ä½“å†…å®¹å’Œå­ View ä¹‹é—´ã€‚è€Œè¿™ä¸ªâ€¦â€¦ å…¶å®å’Œé‡å†™ onDraw() å¹¶æŠŠç»˜åˆ¶ä»£ç å†™åœ¨ super.onDraw() ä¹‹åçš„åšæ³•ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
</li>
<li>
<p><strong>ä»£ç å†™åœ¨super.dispatchDraw(canvas)å</strong>ï¼šåªè¦é‡å†™ dispatchDraw()ï¼Œå¹¶åœ¨ super.dispatchDraw() çš„ä¸‹é¢å†™ä¸Šä½ çš„ç»˜åˆ¶ä»£ç ï¼Œè¿™æ®µç»˜åˆ¶ä»£ç å°±ä¼šå‘ç”Ÿåœ¨å­ View çš„ç»˜åˆ¶ä¹‹åï¼Œä»è€Œè®©ç»˜åˆ¶å†…å®¹ç›–ä½å­ View äº†ã€‚</p>
</li>
</ul>
<p><strong>onDrawForeground(canvas)</strong>ï¼šåŒ…å«äº†æ»‘åŠ¨è¾¹ç¼˜æ¸å˜å’Œæ»‘åŠ¨æ¡è·Ÿå‰æ™¯</p>
<blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ª Viewï¼ˆæˆ– ViewGroupï¼‰çš„ç»˜åˆ¶ä¸ä¼šè¿™å‡ é¡¹å…¨éƒ½åŒ…å«ï¼Œä½†å¿…ç„¶é€ƒä¸å‡ºè¿™å‡ é¡¹ï¼Œå¹¶ä¸”ä¸€å®šä¼šä¸¥æ ¼éµå®ˆè¿™ä¸ªé¡ºåºã€‚ä¾‹å¦‚é€šå¸¸ä¸€ä¸ª LinearLayout åªæœ‰èƒŒæ™¯å’Œå­ Viewï¼Œé‚£ä¹ˆå®ƒä¼šå…ˆç»˜åˆ¶èƒŒæ™¯å†ç»˜åˆ¶å­ Viewï¼›ä¸€ä¸ª ImageView æœ‰ä¸»ä½“ï¼Œæœ‰å¯èƒ½ä¼šå†åŠ ä¸Šä¸€å±‚åŠé€æ˜çš„å‰æ™¯ä½œä¸ºé®ç½©ï¼Œé‚£ä¹ˆå®ƒçš„å‰æ™¯ä¹Ÿä¼šåœ¨ä¸»ä½“ä¹‹åè¿›è¡Œç»˜åˆ¶ã€‚éœ€è¦æ³¨æ„ï¼Œå‰æ™¯çš„æ”¯æŒæ˜¯åœ¨ Android 6.0ï¼ˆä¹Ÿå°±æ˜¯ API 23ï¼‰æ‰åŠ å…¥çš„ï¼›ä¹‹å‰å…¶å®ä¹Ÿæœ‰ï¼Œä¸è¿‡åªæ”¯æŒ FrameLayoutï¼Œè€Œç›´åˆ° 6.0 æ‰æŠŠè¿™ä¸ªæ”¯æŒæ”¾è¿›äº† View ç±»é‡Œã€‚</p>
</blockquote>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi03N2U5ZGFkMzIwNzdmYTFhLnBuZw?x-oss-process=image/format,png" alt=""></p>
<h4><a id="2__625"></a>2. æ³¨æ„äº‹é¡¹</h4>
<h5><a id="21__ViewGroup__dispatchDraw__setWillNotDrawfalse_627"></a>2.1 åœ¨ ViewGroup çš„å­ç±»ä¸­é‡å†™é™¤ dispatchDraw() ä»¥å¤–çš„ç»˜åˆ¶æ–¹æ³•æ—¶ï¼Œå¯èƒ½éœ€è¦è°ƒç”¨ setWillNotDraw(false)ï¼›</h5>
<p><em>å‡ºäºæ•ˆç‡çš„è€ƒè™‘ï¼ŒViewGroup é»˜è®¤ä¼šç»•è¿‡ draw() æ–¹æ³•ï¼Œæ¢è€Œç›´æ¥æ‰§è¡Œ dispatchDraw()ï¼Œä»¥æ­¤æ¥ç®€åŒ–ç»˜åˆ¶æµç¨‹ã€‚æ‰€ä»¥å¦‚æœä½ è‡ªå®šä¹‰äº†æŸä¸ª ViewGroup çš„å­ç±»ï¼ˆæ¯”å¦‚ LinearLayoutï¼‰å¹¶ä¸”éœ€è¦åœ¨å®ƒçš„é™¤ dispatchDraw() ä»¥å¤–çš„ä»»ä½•ä¸€ä¸ªç»˜åˆ¶æ–¹æ³•å†…ç»˜åˆ¶å†…å®¹ï¼Œä½ å¯èƒ½ä¼šéœ€è¦è°ƒç”¨ View.setWillNotDraw(false) è¿™è¡Œä»£ç æ¥åˆ‡æ¢åˆ°å®Œæ•´çš„ç»˜åˆ¶æµç¨‹ï¼ˆæ˜¯ã€Œå¯èƒ½ã€è€Œä¸æ˜¯ã€Œå¿…é¡»ã€çš„åŸå› æ˜¯ï¼Œæœ‰äº› ViewGroup æ˜¯å·²ç»è°ƒç”¨è¿‡ setWillNotDraw(false) äº†çš„ï¼Œä¾‹å¦‚ ScrollViewï¼‰ã€‚</em></p>
<h5><a id="22__onDraw_631"></a>2.2 åœ¨é‡å†™çš„æ–¹æ³•æœ‰å¤šä¸ªé€‰æ‹©æ—¶ï¼Œä¼˜å…ˆé€‰æ‹© onDraw()</h5>
<p><em>ä¸€æ®µç»˜åˆ¶ä»£ç å†™åœ¨ä¸åŒçš„ç»˜åˆ¶æ–¹æ³•ä¸­æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œè¿™æ—¶ä½ å¯ä»¥é€‰ä¸€ä¸ªè‡ªå·±å–œæ¬¢æˆ–è€…ä¹ æƒ¯çš„ç»˜åˆ¶æ–¹æ³•æ¥é‡å†™ã€‚ä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šå¦‚æœç»˜åˆ¶ä»£ç æ—¢å¯ä»¥å†™åœ¨ onDraw() é‡Œï¼Œä¹Ÿå¯ä»¥å†™åœ¨å…¶ä»–ç»˜åˆ¶æ–¹æ³•é‡Œï¼Œé‚£ä¹ˆä¼˜å…ˆå†™åœ¨ onDraw() ï¼Œå› ä¸º Android æœ‰ç›¸å…³çš„ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦é‡ç»˜çš„æ—¶å€™è‡ªåŠ¨è·³è¿‡ onDraw() çš„é‡å¤æ‰§è¡Œï¼Œä»¥æå‡å¼€å‘æ•ˆç‡ã€‚äº«å—è¿™ç§ä¼˜åŒ–çš„åªæœ‰ onDraw() ä¸€ä¸ªæ–¹æ³•ã€‚</em></p>
<h3><a id="ActivityView_635"></a>å…«ã€åœ¨Activityä¸­è·å–Viewçš„å®½é«˜çš„å‡ ç§æ–¹å¼</h3>
<blockquote>
<p>Activity è·å– view çš„å®½é«˜ï¼Œ åœ¨ onCreate , onResume ç­‰æ–¹æ³•ä¸­è·å–åˆ°çš„éƒ½æ˜¯0ï¼Œ å› ä¸º View çš„æµ‹é‡è¿‡ç¨‹å¹¶ä¸æ˜¯å’Œ Activity çš„å£°æ˜å‘¨æœŸåŒæ­¥æ‰§è¡Œçš„</p>
</blockquote>
<p><strong>1. view.post</strong> post å¯ä»¥å°†ä¸€ä¸ª runnable æŠ•é€’åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œç„¶åç­‰å¾… Looper è°ƒç”¨æ­¤ runnable çš„æ—¶å€™ï¼Œ View ä¹Ÿå·²ç»åˆå§‹åŒ–å¥½äº†</p>
<pre><code>       view.post(new Runnable() {
            @Override
            public void run() {
                int width = view.getMeasuredWidth();
                int height = view.getMeasuredHeight(); 
            }
        });
</code></pre>
<p><strong>2. ViewTreeObserver</strong> ä½¿ç”¨ addOnGlobalLayoutListener æ¥å£ï¼Œ å½“ view æ ‘çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æˆ–è€… View æ ‘å†…éƒ¨çš„ view çš„å¯è§æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼Œ onGlobalLayout éƒ½ä¼šè¢«è°ƒç”¨ï¼Œ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ <strong>onGlobalLayout æ–¹æ³•å¯èƒ½è¢«è°ƒç”¨å¤šæ¬¡</strong>ï¼Œ ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code> view.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
            @Override
            public void onGlobalLayout() {
                view.getViewTreeObserver().removeOnGlobalLayoutListener(this);
                int width = view.getMeasuredWidth();
                int height = view.getMeasuredHeight();
            }
        });
</code></pre>
<p><strong>3. onWindowFocusChanged</strong> è¿™ä¸ªæ–¹æ³•çš„å«ä¹‰æ˜¯ View å·²ç»åˆå§‹åŒ–å®Œæ¯•äº†ï¼Œ å®½é«˜å·²ç»å‡†å¤‡å¥½äº†ï¼Œ éœ€è¦æ³¨æ„çš„å°±æ˜¯è¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡ï¼Œ åœ¨ Activity <code>onResume</code> å’Œ<code>onPause</code>çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ï¼Œ <strong>ä¹Ÿä¼šæœ‰å¤šæ¬¡è°ƒç”¨çš„æƒ…å†µ</strong></p>
<pre><code>     @Override
    public void onWindowFocusChanged(boolean hasWindowFocus) {
        super.onWindowFocusChanged(hasWindowFocus);
        if(hasWindowFocus){
            int width = view.getMeasuredWidth();
            int height = view.getMeasuredHeight();
        }
    }
</code></pre>
<p>èŠ‚é€‰è‡ªï¼šæœªæ‰¬å¸†çš„å°èˆ¹https://juejin.im/post/5dde44dc5188250e8b235d83</p>
<h1><a id="_677"></a>æœ€å</h1>
<p>é¢˜å¤–è¯ï¼Œè™½ç„¶æˆ‘åœ¨é˜¿é‡Œå·¥ä½œæ—¶é—´ä¸é•¿ï¼Œä½†ä¹ŸæŒ‡å¯¼è¿‡ä¸å°‘åŒè¡Œã€‚å¾ˆå°‘è·Ÿå¤§å®¶ä¸€èµ·æ¢è®¨ï¼Œä»Šå¹´æ˜¥èŠ‚å—æ­¦æ±‰æ–°å‹å† çŠ¶ç—…æ¯’å½±å“ï¼Œå¤§å®¶éƒ½åªèƒ½åœ¨å®¶åŠå…¬å­¦ä¹ ï¼Œå¾…ç–«æƒ…è¿‡å»ï¼Œå¤§å®¶é‡å½’å·¥ä½œå²—ä½ï¼Œé¢è¯•å’Œå²—ä½æµåŠ¨å¤šèµ·æ¥ï¼Œå› æ­¤å……åˆ†åˆ©ç”¨è¿™æ®µæ—¶é—´å¤ä¹ ï¼Œæœªæ¥åœ¨å¯»æ‰¾å·¥ä½œè¿‡ç¨‹ä¸­å é¢†æœ‰åˆ©ä½ç½®å°±æ˜¾å¾—å°¤ä¸ºé‡è¦äº†ã€‚<br>
åœ¨è¿™é‡Œæˆ‘åˆ†äº«ä¸¤æœ¬ç”±æˆ‘ä»¬é˜¿é‡ŒåŒäº‹æ€»ç»“ã€ŠAndroidé¢è¯•æŒ‡å¯¼ã€‹ï¼Œä»¥åŠã€ŠAndroidæ¶æ„å¸ˆé¢è¯•é¢˜ç²¾ç¼–è§£æå¤§å…¨ã€‹ä¸¤æœ¬ç”µå­ä¹¦åˆ†äº«ç»™è¯»è€…ï¼Œéœ€è¦çš„æœ‹å‹ï¼Œç‚¹å‡»ä¸‹æ–¹é“¾æ¥ï¼Œå‰å¾€å…è´¹é¢†å–ï¼</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0xMmMxNGI0NmNjNDAyMWI2LnBuZw?x-oss-process=image/format,png" alt="ã€ŠAndroidé¢è¯•æŒ‡å¯¼ã€‹"><br>
<strong>ä¸‹è½½åœ°å€ï¼š<a href="https://shimo.im/docs/3Tvytq686Yyv83KX/read" rel="nofollow">https://shimo.im/docs/3Tvytq686Yyv83KX/read</a></strong><br>
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi0wZDhjOTNjZDAzNmNhZmEyLnBuZw?x-oss-process=image/format,png" alt="ã€ŠAndroidæ¶æ„å¸ˆé¢è¯•é¢˜ç²¾ç¼–è§£æå¤§å…¨ã€‹"><br>
<strong>ä¸‹è½½åœ°å€ï¼š<a href="https://shimo.im/docs/3Tvytq686Yyv83KX/read" rel="nofollow">https://shimo.im/docs/3Tvytq686Yyv83KX/read</a></strong></p>

                                    </div>
                <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-60ecaf1f42.css" rel="stylesheet">
                                                <div class="more-toolbox">
                <div class="left-toolbox">
                    <ul class="toolbox-list">
                        
                        <li class="tool-item tool-active is-like "><a href="javascript:;"><svg class="icon" aria-hidden="true">
                            <use xlink:href="#csdnc-thumbsup"></use>
                        </svg><span class="name">ç‚¹èµ</span>
                        <span class="count"></span>
                        </a></li>
                        <li class="tool-item tool-active is-collection "><a href="javascript:;" data-report-click='{"mod":"popu_824"}'><svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-csdnc-Collection-G" ></use>
                        </svg><span class="name">æ”¶è—</span></a></li>
                        <li class="tool-item tool-active is-share"><a href="javascript:;" data-report-click='{"mod":"1582594662_002"}'><svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-csdnc-fenxiang"></use>
                        </svg>åˆ†äº«</a></li>
                        <!--æ‰“èµå¼€å§‹-->
                                                <!--æ‰“èµç»“æŸ-->
                                                <li class="tool-item tool-more">
                            <a>
                            <svg t="1575545411852" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5717" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M179.176 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z" p-id="5718"></path><path d="M509.684 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z" p-id="5719"></path><path d="M846.175 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z" p-id="5720"></path></svg>
                            </a>
                            <ul class="more-box">
                                <li class="item"><a class="article-report">æ–‡ç« ä¸¾æŠ¥</a></li>
                            </ul>
                        </li>
                                            </ul>
                </div>
                            </div>
            <div class="person-messagebox">
                <div class="left-message"><a href="https://blog.csdn.net/weixin_43901866">
                    <img src="https://profile.csdnimg.cn/8/2/E/3_weixin_43901866" class="avatar_pic" username='weixin_43901866'>
                                            <img src="https://g.csdnimg.cn/static/user-reg-year/1x/1.png" class="user-years">
                                    </a></div>
                <div class="middle-message">
                                        <div class="title"><span class="tit"><a href="https://blog.csdn.net/weixin_43901866" data-report-click='{"mod":"popu_379"}' target="_blank">Android Developer</a></span>
                                            </div>
                    <div class="text"><span>å‘å¸ƒäº†450 ç¯‡åŸåˆ›æ–‡ç« </span> Â· <span>è·èµ 730</span> Â· <span>è®¿é—®é‡ 20ä¸‡+</span></div>
                </div>
                                <div class="right-message">
                                            <a href="https://bbs.csdn.net/topics/395532450" target="_blank"
                        class="btn btn-sm btn-red-hollow bt-button personal-messageboard">ä»–çš„ç•™è¨€æ¿
                        </a>
                                                            <a class="btn btn-sm  bt-button personal-watch" data-report-click='{"mod":"popu_379"}'>å…³æ³¨</a>
                                    </div>
                            </div>
                    </div>
    </article>
</div>
</div>
</body>
</html>
