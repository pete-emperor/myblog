<html>
<head>
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/detail-4bfa3af0c6.min.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/themes/skin3-template/skin3-template-c9d2f651cc.min.css">
<link rel="stylesheet" href="https://csdnimg.cn/public/sandalstrap/1.4/css/sandalstrap.min.css">
<link rel="stylesheet" href="https://csdnimg.cn/public/common/toolbar/content_toolbar_css/content_toolbar.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/blog_code-c3a0c33d5c.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/vendor/pagination/paging-e040f0c7c8.css">
<style>
        .MathJax, .MathJax_Message, .MathJax_Preview{
            display: none
        }
    </style>
</head>
<body class="nodata " > 
    <link rel="stylesheet" href="https://csdnimg.cn/public/common/toolbar/content_toolbar_css/content_toolbar.css">
    <script id="toolbar-tpl-scriptId" src="https://csdnimg.cn/public/common/toolbar/js/content_toolbar.js" type="text/javascript" domain="https://blog.csdn.net/"></script>
    <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/blog_code-c3a0c33d5c.css">
<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/vendor/pagination/paging-e040f0c7c8.css">

<script type="text/javascript">
	var NEWS_FEED = function(){}
</script>

<link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/chart-3456820cac.css" />
<div class="main_father clearfix d-flex justify-content-center" style="height:100%;"> 
    <div class="container clearfix" id="mainBox">
        <div  class='space_container'></div>
        <main>
            <div class="blog-content-box">
    <div class="article-header-box">
        <div class="article-header">
            <div class="article-title-box">
                <h1 class="title-article">【建议收藏】面试没有亮点？给你一份Android热门三方库源码面试宝典</h1>
            </div>
            <div class="article-info-box">
                <div class="article-bar-top">
                    <!--文章类型-->
                    <span class="article-type type-1 float-left">原创</span>                                                                                                                                            <a class="follow-nickName" href="https://me.csdn.net/weixin_43901866" target="_blank" rel="noopener">Android Developer</a>
                    <span class="time">最后发布于2020-03-19 10:22:59                    </span>
                    <span class="read-count">阅读数 17</span>
                    <a id='blog_detail_zk_collection' class="un-collection" data-report-click='{"mod":"popu_823"}'>
                        <svg class="icon">
                            <use xlink:href="#icon-csdnc-Collection-G" ></use>
                        </svg>
                        <span>收藏</span>
                    </a>
                                    </div>
                                <div class="up-time">发布于2020-03-19 10:22:59</div>
                <div class="slide-content-box">
                                                        <div class="tags-box artic-tag-box">
                           <span class="label">分类专栏：</span>
                                                                                             <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9337526.html">
                                       阿里                                   </a>
                                                                                                                            <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9584164.html">
                                       京东                                   </a>
                                                                                                                            <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9605682.html">
                                       字节跳动                                   </a>
                                                                                  </div>
                                                                                                           <div class="article-copyright">
                        <span class="creativecommons">
                            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"></a>
                            <span>
                                版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 BY-SA </a>版权协议，转载请附上原文出处链接和本声明。                            </span>
                            <div class="article-source-link2222">
                                本文链接：<a href="https://blog.csdn.net/weixin_43901866/article/details/104961570">https://blog.csdn.net/weixin_43901866/article/details/104961570</a>
                            </div>
                        </span> 
                        </div>
                                                                                </div>
                <div class="operating">
                                                                <a class="href-article-edit slide-toggle">展开</a>
                                    </div>
            </div>
        </div>
    </div>
    <article class="baidu_pl">
        <!--python安装手册开始-->
                <!--python安装手册结束-->
                <!--####专栏广告位图文切换开始-->
                                    <!--####专栏广告位图文切换结束-->
         <div id="article_content" class="article_content clearfix">
            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-833878f763.css" />
                            <div id="content_views" class="markdown_views prism-atom-one-dark">
                    <!-- flowchart 箭头图标 勿删 -->
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                                            <h1><a id="_0"></a>前言</h1>
<h3><a id="AndroidhttpsgithubcomJsonChaoAwesomeAndroidExercise_2"></a>成为一名优秀的Android开发，需要一份完备的<a href="https://github.com/JsonChao/Awesome-Android-Exercise">知识体系</a>，在这里，让我们一起成长为自己所想的那样~。</h3>
<p>众所周知，<strong>优秀源码的阅读与理解是最能提升自身功力的途径</strong>，如果想要成为一名优秀的Android工程师，那么<strong>Android中优秀三方库源码的分析和理解则是必备技能</strong>。就拿比较热门的图片加载框架Glide来说，相信很多同学都使用过，那么，当别人问你下面这些问题时你是否能回答出来呢？（Glide五连发）</p>
<ul>
<li>1、为什么要在项目中使用这个库？</li>
<li>2、这个库都有哪些用法？对应什么样的使用场景？</li>
<li>3、这个库的核心实现原理是什么？如果让你实现这个库的某些核心功能，你会考虑怎么去实现？</li>
<li>4、Glide源码机制的核心思想是什么？</li>
<li>5、Glide中是如何计算一张图片的大小的？</li>
</ul>
<p>相信能全部回答出来的同学并不多，下面我来解答一下上面几个问题。</p>
<h3><a id="1_14"></a>1、为什么要在项目中使用这个库？</h3>
<ul>
<li>1、多样化媒体加载：不仅可以进行图片缓存，还支持Gif、WebP、缩略图，甚至是Video。</li>
<li>2、通过设置绑定生命周期：可以使加载图片的生命周期动态管理起来。</li>
<li>3、高效的缓存策略：支持内存、Disk缓存，并且Picasso只会缓存原始尺寸的图片，而Glide缓存的是多种规格，也就是Glide会根据你ImageView的大小来缓存相应大小的图片尺寸。</li>
<li>4、内存开销小：默认的Bitmap格式是RGB_565格式，而Picasso默认的是ARGB_8888格式，内存开销小一半。</li>
</ul>
<h3><a id="2_21"></a>2、这个库都有哪些用法？对应什么样的使用场景？</h3>
<ul>
<li>1、图片加载：Glide.with(this).load(imageUrl).override(800, 800).placeholder().error().animate().into()。</li>
<li>2、多样式媒体加载：asBitamp、asGif。</li>
<li>3、生命周期集成。</li>
<li>4、可以配置磁盘缓存策略ALL、NONE、SOURCE、RESULT。</li>
</ul>
<h3><a id="3_28"></a>3、这个库的核心实现原理是什么？如果让你实现这个库的某些核心功能，你会考虑怎么去实现？</h3>
<p>要想了解Glide的核心实现原理，就必须先从它的加载API Glide.with().into()来进行分析。</p>
<h4><a id="1Glidewith_32"></a>1、Glide&amp;with：</h4>
<ul>
<li>1、初始化各式各样的配置信息（包括缓存，请求线程池，大小，图片格式等等）以及glide对象。</li>
<li>2、将glide请求和application/SupportFragment/Fragment的生命周期绑定在一块。</li>
</ul>
<h4><a id="2Glideload_37"></a>2、Glide&amp;load：</h4>
<p>设置请求url，并记录url已设置的状态。</p>
<h4><a id="3Glideinto_41"></a>3、Glide&amp;into：</h4>
<ul>
<li>1、首先根据转码类transcodeClass类型返回不同的ImageViewTarget：BitmapImageViewTarget、DrawableImageViewTarget。</li>
<li>2、递归建立缩略图请求，没有缩略图请求，则直接进行正常请求。</li>
<li>3、如果没指定宽高，会根据ImageView的宽高计算出图片宽高，最终执行到onSizeReay()方法中的engine.load()方法。</li>
<li>4、engine是一个负责加载和管理缓存资源的类</li>
</ul>
<p>其中Glide的三层缓存机制是值得我们去反复学习揣摩的，这里我们先了解下常规的三级缓存是怎样的。</p>
<h4><a id="_50"></a>常规三级缓存的流程：强引用-&gt;软引用-&gt;硬盘缓存</h4>
<p>当我们的APP中想要加载某张图片时，先去LruCache中寻找图片，如果LruCache中有，则直接取出来使用，如果LruCache中没有，则去SoftReference中寻找（软引用适合当cache，当内存吃紧的时候才会被回收。而weakReference在每次system.gc（）就会被回收）（当LruCache存储紧张时，会把最近最少使用的数据放到SoftReference中），如果SoftReference中有，则从SoftReference中取出图片使用，同时将图片重新放回到LruCache中，如果SoftReference中也没有图片，则去硬盘缓存中中寻找，如果有则取出来使用，同时将图片添加到LruCache中，如果没有，则连接网络从网上下载图片。图片下载完成后，将图片保存到硬盘缓存中，然后放到LruCache中。</p>
<h4><a id="Glide_54"></a>Glide的三层缓存机制</h4>
<p>Glide缓存机制大致分为三层：内存缓存、弱引用缓存、磁盘缓存。</p>
<ul>
<li>取的顺序是：内存、弱引用、磁盘。</li>
<li>存的顺序是：弱引用、内存、磁盘。</li>
</ul>
<p>三层存储的机制在Engine中实现的。先说下Engine是什么？Engine这一层负责加载时做管理内存缓存的逻辑。持有MemoryCache、Map&lt;Key, WeakReference&lt;EngineResource&lt;?&gt;&gt;&gt;。通过load（）来加载图片，加载前后会做内存存储的逻辑。如果内存缓存中没有，那么才会使用EngineJob这一层来进行异步获取硬盘资源或网络资源。EngineJob类似一个异步线程或observable。Engine是一个全局唯一的，通过Glide.getEngine()来获取。</p>
<p>需要一个图片资源，如果Lrucache中有相应的资源图片，那么就返回，同时从Lrucache中清除，放到activeResources中。activeResources map是盛放正在使用的资源，以弱引用的形式存在。同时资源内部有被引用的记录。如果资源没有引用记录了，那么再放回Lrucache中，同时从activeResources中清除。如果Lrucache中没有，就从activeResources中找，找到后相应资源引用加1。如果Lrucache和activeResources中没有，那么进行资源异步请求（网络/diskLrucache），请求成功后，资源放到diskLrucache和activeResources中。</p>
<h3><a id="4Glide_65"></a>4、Glide源码机制的核心思想：</h3>
<p>使用一个弱引用map activeResources来盛放项目中正在使用的资源。Lrucache中不含有正在使用的资源。资源内部有个计数器来显示自己是不是还有被引用的情况，把正在使用的资源和没有被使用的资源分开有什么好处呢？？因为当Lrucache需要移除一个缓存时，会调用resource.recycle()方法。注意到该方法上面注释写着只有没有任何consumer引用该资源的时候才可以调用这个方法。那么为什么调用resource.recycle()方法需要保证该资源没有任何consumer引用呢？glide中resource定义的recycle（）要做的事情是把这个不用的资源（假设是bitmap或drawable）放到bitmapPool中。bitmapPool是一个bitmap回收再利用的库，在做transform的时候会从这个bitmapPool中拿一个bitmap进行再利用。这样就避免了重新创建bitmap，减少了内存的开支。而既然bitmapPool中的bitmap会被重复利用，那么肯定要保证回收该资源的时候（即调用资源的recycle（）时），要保证该资源真的没有外界引用了。这也是为什么glide花费那么多逻辑来保证Lrucache中的资源没有外界引用的原因。</p>
<h3><a id="5Glide_69"></a>5、Glide中是如何计算一张图片的大小的？</h3>
<p>图片占用内存的计算公式：图片高度 * 图片宽度 * 一个像素占用的内存大小。所以，计算图片占用内存大小的时候，要考虑图片所在的目录跟设备密度，这两个因素其实影响的是图片的宽高，android会对图片进行拉升跟压缩。</p>
<p>上面笔者只是简单地讲解一下下Glide的内部实现机制，但是这是远远不够的，如果想要对Glide或其它热门三方库有足够<strong>具象</strong>地了解，就<strong>必须深入源码去感受其中的艺术</strong>。</p>
<h2><a id="Android_75"></a>助力一份Android热门三方库源码面试宝典</h2>
<p>因此，为了将热门三方库涉及的知识<strong>成体系</strong>地融合起来，笔者创建了Awesome-Third-Library-Source-Analysis这个项目，为的就是让每一个Android工程师能够从以下<strong>七个方面全方位地提升自己的技术实力</strong>。</p>
<p><a href="https://github.com/JsonChao/Awesome-Third-Library-Source-Analysis">项目地址：Awesome-Third-Library-Source-Analysis</a></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi1iNThmNDkzNzlhM2NhNGI1LnBuZw?x-oss-process=image/format,png" alt=""></p>
<blockquote>
<p>深入理解热门三方库实现原理，从七个角度全方位提升你的功力~</p>
</blockquote>
<h2><a id="Contents_86"></a>Contents</h2>
<h3><a id="_88"></a>网络</h3>
<ul>
<li><a href="https://juejin.im/post/5e1be39b6fb9a02fcd130d1f" rel="nofollow">OkHttp</a> （已完成）</li>
</ul>
<p>Android最优秀的网络底层框架，没有之一。</p>
<ul>
<li><a href="https://juejin.im/post/5e1fb9386fb9a0300a4501a6" rel="nofollow">Retrofit</a> （已完成）</li>
</ul>
<p>Android最优秀的网络封装框架，内含九种常用设计模式的灵活运用。</p>
<h3><a id="_98"></a>图片</h3>
<ul>
<li><a href="https://juejin.im/post/5e2109e25188254c257c40c6" rel="nofollow">Glide</a> （已完成）</li>
</ul>
<p>Android使用最广泛的图片加载框架。</p>
<h3><a id="_104"></a>数据库</h3>
<ul>
<li><a href="https://juejin.im/post/5e44b3c2e51d4526ec0d2b71" rel="nofollow">GreenDao</a> （已完成）</li>
</ul>
<p>Android中数据库操作综合效率最高的框架。</p>
<h3><a id="_110"></a>响应式编程</h3>
<ul>
<li><a href="https://juejin.im/post/5e4c9d45518825496e7847b1" rel="nofollow">RxJava</a> （已完成）</li>
</ul>
<p>来一起探究RxJava的异步、简洁、优雅和它强大的操作符吧！</p>
<h3><a id="_116"></a>内存泄露</h3>
<ul>
<li><a href="https://juejin.im/post/5e5330f8e51d4526d43f30ef" rel="nofollow">LeakCanary</a> （已完成）</li>
</ul>
<p>LeakCanary究竟是如何检测出内存泄露的呢？</p>
<h3><a id="_122"></a>依赖注入</h3>
<ul>
<li><a href="https://juejin.im/post/5e55d38d518825491753ae39" rel="nofollow">ButterKnife</a>（已完成）</li>
</ul>
<p>使用APT + 注解攻破了findViewByid()，JW大神之作。</p>
<ul>
<li><a href="https://juejin.im/post/5e58779f518825493f6ce7eb" rel="nofollow">Dagger2</a>（已完成）</li>
</ul>
<p>Dagger就一把匕首，在中大型项目中，它能提升开发效率、自动管理类的实例、解耦，是如此的干脆。</p>
<h3><a id="_132"></a>事件总线</h3>
<ul>
<li><a href="https://juejin.im/post/5e61b253e51d45270e212eb4" rel="nofollow">EventBus</a>（已完成）</li>
</ul>
<p>使用扩展的观察者模式实现的组件间通信框架，广播的替代者。</p>
<p><strong>推荐阅读：<a href="https://blog.csdn.net/AndroidAlvin/article/details/104769685">2017-2020历年字节跳动Android面试真题解析（累计下载1082万次，持续更新中）</a></strong></p>
<p>作者：jsonchao<br>
链接：https://juejin.im/post/5e65ad276fb9a07cc01a3264<br>
来源：掘金</p>

                                    </div>
                <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-60ecaf1f42.css" rel="stylesheet">
                                                <div class="more-toolbox">
                <div class="left-toolbox">
                    <ul class="toolbox-list">
                        
                        <li class="tool-item tool-active is-like "><a href="javascript:;"><svg class="icon" aria-hidden="true">
                            <use xlink:href="#csdnc-thumbsup"></use>
                        </svg><span class="name">点赞</span>
                        <span class="count"></span>
                        </a></li>
                        <li class="tool-item tool-active is-collection "><a href="javascript:;" data-report-click='{"mod":"popu_824"}'><svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-csdnc-Collection-G" ></use>
                        </svg><span class="name">收藏</span></a></li>
                        <li class="tool-item tool-active is-share"><a href="javascript:;" data-report-click='{"mod":"1582594662_002"}'><svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-csdnc-fenxiang"></use>
                        </svg>分享</a></li>
                        <!--打赏开始-->
                                                <!--打赏结束-->
                                                <li class="tool-item tool-more">
                            <a>
                            <svg t="1575545411852" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5717" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style>
</head>
<body>
<div style="width:852px;margin:0 auto;">
<div class="blog-content-box">
    <div class="article-header-box">
        <div class="article-header">
            <div class="article-title-box">
                <h1 class="title-article">【建议收藏】面试没有亮点？给你一份Android热门三方库源码面试宝典</h1>
            </div>
            <div class="article-info-box">
                <div class="article-bar-top">
                    <!--文章类型-->
                    <span class="article-type type-1 float-left">原创</span>                                                                                                                                            <a class="follow-nickName" href="https://me.csdn.net/weixin_43901866" target="_blank" rel="noopener">Android Developer</a>
                    <span class="time">最后发布于2020-03-19 10:22:59                    </span>
                    <span class="read-count">阅读数 17</span>
                    <a id='blog_detail_zk_collection' class="un-collection" data-report-click='{"mod":"popu_823"}'>
                        <svg class="icon">
                            <use xlink:href="#icon-csdnc-Collection-G" ></use>
                        </svg>
                        <span>收藏</span>
                    </a>
                                    </div>
                                <div class="up-time">发布于2020-03-19 10:22:59</div>
                <div class="slide-content-box">
                                                        <div class="tags-box artic-tag-box">
                           <span class="label">分类专栏：</span>
                                                                                             <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9337526.html">
                                       阿里                                   </a>
                                                                                                                            <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9584164.html">
                                       京东                                   </a>
                                                                                                                            <a class="tag-link" target="_blank" rel="noopener"
                                      href="https://blog.csdn.net/weixin_43901866/category_9605682.html">
                                       字节跳动                                   </a>
                                                                                  </div>
                                                                                                           <div class="article-copyright">
                        <span class="creativecommons">
                            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"></a>
                            <span>
                                版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 BY-SA </a>版权协议，转载请附上原文出处链接和本声明。                            </span>
                            <div class="article-source-link2222">
                                本文链接：<a href="https://blog.csdn.net/weixin_43901866/article/details/104961570">https://blog.csdn.net/weixin_43901866/article/details/104961570</a>
                            </div>
                        </span> 
                        </div>
                                                                                </div>
                <div class="operating">
                                                                <a class="href-article-edit slide-toggle">展开</a>
                                    </div>
            </div>
        </div>
    </div>
    <article class="baidu_pl">
        <!--python安装手册开始-->
                <!--python安装手册结束-->
                <!--####专栏广告位图文切换开始-->
                                    <!--####专栏广告位图文切换结束-->
         <div id="article_content" class="article_content clearfix">
            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-833878f763.css" />
                            <div id="content_views" class="markdown_views prism-atom-one-dark">
                    <!-- flowchart 箭头图标 勿删 -->
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                                            <h1><a id="_0"></a>前言</h1>
<h3><a id="AndroidhttpsgithubcomJsonChaoAwesomeAndroidExercise_2"></a>成为一名优秀的Android开发，需要一份完备的<a href="https://github.com/JsonChao/Awesome-Android-Exercise">知识体系</a>，在这里，让我们一起成长为自己所想的那样~。</h3>
<p>众所周知，<strong>优秀源码的阅读与理解是最能提升自身功力的途径</strong>，如果想要成为一名优秀的Android工程师，那么<strong>Android中优秀三方库源码的分析和理解则是必备技能</strong>。就拿比较热门的图片加载框架Glide来说，相信很多同学都使用过，那么，当别人问你下面这些问题时你是否能回答出来呢？（Glide五连发）</p>
<ul>
<li>1、为什么要在项目中使用这个库？</li>
<li>2、这个库都有哪些用法？对应什么样的使用场景？</li>
<li>3、这个库的核心实现原理是什么？如果让你实现这个库的某些核心功能，你会考虑怎么去实现？</li>
<li>4、Glide源码机制的核心思想是什么？</li>
<li>5、Glide中是如何计算一张图片的大小的？</li>
</ul>
<p>相信能全部回答出来的同学并不多，下面我来解答一下上面几个问题。</p>
<h3><a id="1_14"></a>1、为什么要在项目中使用这个库？</h3>
<ul>
<li>1、多样化媒体加载：不仅可以进行图片缓存，还支持Gif、WebP、缩略图，甚至是Video。</li>
<li>2、通过设置绑定生命周期：可以使加载图片的生命周期动态管理起来。</li>
<li>3、高效的缓存策略：支持内存、Disk缓存，并且Picasso只会缓存原始尺寸的图片，而Glide缓存的是多种规格，也就是Glide会根据你ImageView的大小来缓存相应大小的图片尺寸。</li>
<li>4、内存开销小：默认的Bitmap格式是RGB_565格式，而Picasso默认的是ARGB_8888格式，内存开销小一半。</li>
</ul>
<h3><a id="2_21"></a>2、这个库都有哪些用法？对应什么样的使用场景？</h3>
<ul>
<li>1、图片加载：Glide.with(this).load(imageUrl).override(800, 800).placeholder().error().animate().into()。</li>
<li>2、多样式媒体加载：asBitamp、asGif。</li>
<li>3、生命周期集成。</li>
<li>4、可以配置磁盘缓存策略ALL、NONE、SOURCE、RESULT。</li>
</ul>
<h3><a id="3_28"></a>3、这个库的核心实现原理是什么？如果让你实现这个库的某些核心功能，你会考虑怎么去实现？</h3>
<p>要想了解Glide的核心实现原理，就必须先从它的加载API Glide.with().into()来进行分析。</p>
<h4><a id="1Glidewith_32"></a>1、Glide&amp;with：</h4>
<ul>
<li>1、初始化各式各样的配置信息（包括缓存，请求线程池，大小，图片格式等等）以及glide对象。</li>
<li>2、将glide请求和application/SupportFragment/Fragment的生命周期绑定在一块。</li>
</ul>
<h4><a id="2Glideload_37"></a>2、Glide&amp;load：</h4>
<p>设置请求url，并记录url已设置的状态。</p>
<h4><a id="3Glideinto_41"></a>3、Glide&amp;into：</h4>
<ul>
<li>1、首先根据转码类transcodeClass类型返回不同的ImageViewTarget：BitmapImageViewTarget、DrawableImageViewTarget。</li>
<li>2、递归建立缩略图请求，没有缩略图请求，则直接进行正常请求。</li>
<li>3、如果没指定宽高，会根据ImageView的宽高计算出图片宽高，最终执行到onSizeReay()方法中的engine.load()方法。</li>
<li>4、engine是一个负责加载和管理缓存资源的类</li>
</ul>
<p>其中Glide的三层缓存机制是值得我们去反复学习揣摩的，这里我们先了解下常规的三级缓存是怎样的。</p>
<h4><a id="_50"></a>常规三级缓存的流程：强引用-&gt;软引用-&gt;硬盘缓存</h4>
<p>当我们的APP中想要加载某张图片时，先去LruCache中寻找图片，如果LruCache中有，则直接取出来使用，如果LruCache中没有，则去SoftReference中寻找（软引用适合当cache，当内存吃紧的时候才会被回收。而weakReference在每次system.gc（）就会被回收）（当LruCache存储紧张时，会把最近最少使用的数据放到SoftReference中），如果SoftReference中有，则从SoftReference中取出图片使用，同时将图片重新放回到LruCache中，如果SoftReference中也没有图片，则去硬盘缓存中中寻找，如果有则取出来使用，同时将图片添加到LruCache中，如果没有，则连接网络从网上下载图片。图片下载完成后，将图片保存到硬盘缓存中，然后放到LruCache中。</p>
<h4><a id="Glide_54"></a>Glide的三层缓存机制</h4>
<p>Glide缓存机制大致分为三层：内存缓存、弱引用缓存、磁盘缓存。</p>
<ul>
<li>取的顺序是：内存、弱引用、磁盘。</li>
<li>存的顺序是：弱引用、内存、磁盘。</li>
</ul>
<p>三层存储的机制在Engine中实现的。先说下Engine是什么？Engine这一层负责加载时做管理内存缓存的逻辑。持有MemoryCache、Map&lt;Key, WeakReference&lt;EngineResource&lt;?&gt;&gt;&gt;。通过load（）来加载图片，加载前后会做内存存储的逻辑。如果内存缓存中没有，那么才会使用EngineJob这一层来进行异步获取硬盘资源或网络资源。EngineJob类似一个异步线程或observable。Engine是一个全局唯一的，通过Glide.getEngine()来获取。</p>
<p>需要一个图片资源，如果Lrucache中有相应的资源图片，那么就返回，同时从Lrucache中清除，放到activeResources中。activeResources map是盛放正在使用的资源，以弱引用的形式存在。同时资源内部有被引用的记录。如果资源没有引用记录了，那么再放回Lrucache中，同时从activeResources中清除。如果Lrucache中没有，就从activeResources中找，找到后相应资源引用加1。如果Lrucache和activeResources中没有，那么进行资源异步请求（网络/diskLrucache），请求成功后，资源放到diskLrucache和activeResources中。</p>
<h3><a id="4Glide_65"></a>4、Glide源码机制的核心思想：</h3>
<p>使用一个弱引用map activeResources来盛放项目中正在使用的资源。Lrucache中不含有正在使用的资源。资源内部有个计数器来显示自己是不是还有被引用的情况，把正在使用的资源和没有被使用的资源分开有什么好处呢？？因为当Lrucache需要移除一个缓存时，会调用resource.recycle()方法。注意到该方法上面注释写着只有没有任何consumer引用该资源的时候才可以调用这个方法。那么为什么调用resource.recycle()方法需要保证该资源没有任何consumer引用呢？glide中resource定义的recycle（）要做的事情是把这个不用的资源（假设是bitmap或drawable）放到bitmapPool中。bitmapPool是一个bitmap回收再利用的库，在做transform的时候会从这个bitmapPool中拿一个bitmap进行再利用。这样就避免了重新创建bitmap，减少了内存的开支。而既然bitmapPool中的bitmap会被重复利用，那么肯定要保证回收该资源的时候（即调用资源的recycle（）时），要保证该资源真的没有外界引用了。这也是为什么glide花费那么多逻辑来保证Lrucache中的资源没有外界引用的原因。</p>
<h3><a id="5Glide_69"></a>5、Glide中是如何计算一张图片的大小的？</h3>
<p>图片占用内存的计算公式：图片高度 * 图片宽度 * 一个像素占用的内存大小。所以，计算图片占用内存大小的时候，要考虑图片所在的目录跟设备密度，这两个因素其实影响的是图片的宽高，android会对图片进行拉升跟压缩。</p>
<p>上面笔者只是简单地讲解一下下Glide的内部实现机制，但是这是远远不够的，如果想要对Glide或其它热门三方库有足够<strong>具象</strong>地了解，就<strong>必须深入源码去感受其中的艺术</strong>。</p>
<h2><a id="Android_75"></a>助力一份Android热门三方库源码面试宝典</h2>
<p>因此，为了将热门三方库涉及的知识<strong>成体系</strong>地融合起来，笔者创建了Awesome-Third-Library-Source-Analysis这个项目，为的就是让每一个Android工程师能够从以下<strong>七个方面全方位地提升自己的技术实力</strong>。</p>
<p><a href="https://github.com/JsonChao/Awesome-Third-Library-Source-Analysis">项目地址：Awesome-Third-Library-Source-Analysis</a></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xODQ1MjUzNi1iNThmNDkzNzlhM2NhNGI1LnBuZw?x-oss-process=image/format,png" alt=""></p>
<blockquote>
<p>深入理解热门三方库实现原理，从七个角度全方位提升你的功力~</p>
</blockquote>
<h2><a id="Contents_86"></a>Contents</h2>
<h3><a id="_88"></a>网络</h3>
<ul>
<li><a href="https://juejin.im/post/5e1be39b6fb9a02fcd130d1f" rel="nofollow">OkHttp</a> （已完成）</li>
</ul>
<p>Android最优秀的网络底层框架，没有之一。</p>
<ul>
<li><a href="https://juejin.im/post/5e1fb9386fb9a0300a4501a6" rel="nofollow">Retrofit</a> （已完成）</li>
</ul>
<p>Android最优秀的网络封装框架，内含九种常用设计模式的灵活运用。</p>
<h3><a id="_98"></a>图片</h3>
<ul>
<li><a href="https://juejin.im/post/5e2109e25188254c257c40c6" rel="nofollow">Glide</a> （已完成）</li>
</ul>
<p>Android使用最广泛的图片加载框架。</p>
<h3><a id="_104"></a>数据库</h3>
<ul>
<li><a href="https://juejin.im/post/5e44b3c2e51d4526ec0d2b71" rel="nofollow">GreenDao</a> （已完成）</li>
</ul>
<p>Android中数据库操作综合效率最高的框架。</p>
<h3><a id="_110"></a>响应式编程</h3>
<ul>
<li><a href="https://juejin.im/post/5e4c9d45518825496e7847b1" rel="nofollow">RxJava</a> （已完成）</li>
</ul>
<p>来一起探究RxJava的异步、简洁、优雅和它强大的操作符吧！</p>
<h3><a id="_116"></a>内存泄露</h3>
<ul>
<li><a href="https://juejin.im/post/5e5330f8e51d4526d43f30ef" rel="nofollow">LeakCanary</a> （已完成）</li>
</ul>
<p>LeakCanary究竟是如何检测出内存泄露的呢？</p>
<h3><a id="_122"></a>依赖注入</h3>
<ul>
<li><a href="https://juejin.im/post/5e55d38d518825491753ae39" rel="nofollow">ButterKnife</a>（已完成）</li>
</ul>
<p>使用APT + 注解攻破了findViewByid()，JW大神之作。</p>
<ul>
<li><a href="https://juejin.im/post/5e58779f518825493f6ce7eb" rel="nofollow">Dagger2</a>（已完成）</li>
</ul>
<p>Dagger就一把匕首，在中大型项目中，它能提升开发效率、自动管理类的实例、解耦，是如此的干脆。</p>
<h3><a id="_132"></a>事件总线</h3>
<ul>
<li><a href="https://juejin.im/post/5e61b253e51d45270e212eb4" rel="nofollow">EventBus</a>（已完成）</li>
</ul>
<p>使用扩展的观察者模式实现的组件间通信框架，广播的替代者。</p>
<p><strong>推荐阅读：<a href="https://blog.csdn.net/AndroidAlvin/article/details/104769685">2017-2020历年字节跳动Android面试真题解析（累计下载1082万次，持续更新中）</a></strong></p>
<p>作者：jsonchao<br>
链接：https://juejin.im/post/5e65ad276fb9a07cc01a3264<br>
来源：掘金</p>

                                    </div>
                <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-60ecaf1f42.css" rel="stylesheet">
                                                <div class="more-toolbox">
                <div class="left-toolbox">
                    <ul class="toolbox-list">
                        
                        <li class="tool-item tool-active is-like "><a href="javascript:;"><svg class="icon" aria-hidden="true">
                            <use xlink:href="#csdnc-thumbsup"></use>
                        </svg><span class="name">点赞</span>
                        <span class="count"></span>
                        </a></li>
                        <li class="tool-item tool-active is-collection "><a href="javascript:;" data-report-click='{"mod":"popu_824"}'><svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-csdnc-Collection-G" ></use>
                        </svg><span class="name">收藏</span></a></li>
                        <li class="tool-item tool-active is-share"><a href="javascript:;" data-report-click='{"mod":"1582594662_002"}'><svg class="icon" aria-hidden="true">
                            <use xlink:href="#icon-csdnc-fenxiang"></use>
                        </svg>分享</a></li>
                        <!--打赏开始-->
                                                <!--打赏结束-->
                                                <li class="tool-item tool-more">
                            <a>
                            <svg t="1575545411852" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5717" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M179.176 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z" p-id="5718"></path><path d="M509.684 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z" p-id="5719"></path><path d="M846.175 499.222m-113.245 0a113.245 113.245 0 1 0 226.49 0 113.245 113.245 0 1 0-226.49 0Z" p-id="5720"></path></svg>
                            </a>
                            <ul class="more-box">
                                <li class="item"><a class="article-report">文章举报</a></li>
                            </ul>
                        </li>
                                            </ul>
                </div>
                            </div>
            <div class="person-messagebox">
                <div class="left-message"><a href="https://blog.csdn.net/weixin_43901866">
                    <img src="https://profile.csdnimg.cn/8/2/E/3_weixin_43901866" class="avatar_pic" username='weixin_43901866'>
                                            <img src="https://g.csdnimg.cn/static/user-reg-year/1x/1.png" class="user-years">
                                    </a></div>
                <div class="middle-message">
                                        <div class="title"><span class="tit"><a href="https://blog.csdn.net/weixin_43901866" data-report-click='{"mod":"popu_379"}' target="_blank">Android Developer</a></span>
                                            </div>
                    <div class="text"><span>发布了450 篇原创文章</span> · <span>获赞 730</span> · <span>访问量 20万+</span></div>
                </div>
                                <div class="right-message">
                                            <a href="https://bbs.csdn.net/topics/395532450" target="_blank"
                        class="btn btn-sm btn-red-hollow bt-button personal-messageboard">他的留言板
                        </a>
                                                            <a class="btn btn-sm  bt-button personal-watch" data-report-click='{"mod":"popu_379"}'>关注</a>
                                    </div>
                            </div>
                    </div>
    </article>
</div>
</div>
</body>
</html>
